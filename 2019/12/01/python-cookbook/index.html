<!DOCTYPE html>
<html>
<head hexo-theme="https://github.com/volantis-x/hexo-theme-volantis/tree/4.0.0-rc.4"><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="x-dns-prefetch-control" content="on">

  <!-- 页面元数据 -->
  
  <title>python cookbook - 玖玖的博客</title>
  
    <meta name="keywords" content="python,ing,time">
  

  
    <meta name="description" content=" 

python cookbook的阅读笔记，对内容进行了简练。将常用的知识点记录下来。">
  

  <!-- feed -->
  

  <!-- import meta -->
  

  <!-- link -->
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14/css/all.min.css">
  
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css">
  

  

  

  

  

  <!-- import link -->
  

  
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.18.1/styles/solarized-light.css">
    
  
  
    <link rel="stylesheet" href="/css/style.css">
  
  
  
  <!-- 脚本懒加载函数 -->
  <script>
  function loadScript(src, cb) {
    var HEAD = document.getElementsByTagName('head')[0] || document.documentElement;
    var script = document.createElement('script');
    script.setAttribute('type','text/javascript');
    if (cb) script.onload = cb;
    script.setAttribute('src', src);
    HEAD.appendChild(script);
  }
  //https://github.com/filamentgroup/loadCSS
  !function(c){"use strict";var e=function(e,t,n,r){var o,i=c.document,a=i.createElement("link");if(t)o=t;else{var d=(i.body||i.getElementsByTagName("head")[0]).childNodes;o=d[d.length-1]}var f=i.styleSheets;if(r)for(var l in r)r.hasOwnProperty(l)&&a.setAttribute(l,r[l]);a.rel="stylesheet",a.href=e,a.media="only x",function e(t){if(i.body)return t();setTimeout(function(){e(t)})}(function(){o.parentNode.insertBefore(a,t?o:o.nextSibling)});var s=function(e){for(var t=a.href,n=f.length;n--;)if(f[n].href===t)return e();setTimeout(function(){s(e)})};function u(){a.addEventListener&&a.removeEventListener("load",u),a.media=n||"all"}return a.addEventListener&&a.addEventListener("load",u),(a.onloadcssdefined=s)(u),a};"undefined"!=typeof exports?exports.loadCSS=e:c.loadCSS=e}("undefined"!=typeof global?global:this);
  </script>
  <script id="loadcss"></script>
</head>

<body>
  <header class="l_header auto shadow blur " style='opacity: 0' >
  <div class='container'>
  <div class='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h m-phone' id="pjax-header-nav-list">
        <li><a class="s-comment fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a class="s-toc fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
            <img no-lazy class='logo' src='https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/blog/Logo-NavBar@3x.png'/>
          
          
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h m-pc'>
          
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>博客
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/friends/
                  
                  
                  
                    id="friends"
                  >
                  <i class='fas fa-link fa-fw'></i>友链
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于
                </a>
                
              </li>
            
          
          
				</ul>
			</div>

      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fas fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="Search..." />
        </form>
      </div>

			<ul class='switcher nav-list-h m-phone'>
				
					<li><a class="s-search fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
				
				<li>
          <a class="s-menu fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>博客
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/friends/
                  
                  
                  
                    id="friends"
                  >
                  <i class='fas fa-link fa-fw'></i>友链
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于
                </a>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>
		</div>
	</div>
  </div>
</header>

  <div class="l_body">
    <div class="l_cover">
  
    
    
        <div class='cover-wrapper post search' style="display: none;">
          
            <div class='cover-backstretch'></div>
          
          <div class='cover-body'>
  <div class='top'>
    
    
      <p class="title">玖玖</p>
    
    
      <p class="subtitle">^_^</p>
    
  </div>
  <div class='bottom'>
    
      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <input type="text" class="input u-search-input" placeholder="Search..." />
          <i class="icon fas fa-search fa-fw"></i>
        </form>
      </div>
    
    <div class='menu navigation'>
      <div class='list-h'>
        
          
            <a href="/v4/getting-started/"
              
              
              id="v4getting-started">
              <p>文档</p>
            </a>
          
            <a href="/faqs/"
              
              
              id="faqs">
              <p>帮助</p>
            </a>
          
            <a href="/examples/"
              
              
              id="examples">
              <p>示例</p>
            </a>
          
            <a href="/contributors/"
              
              
              id="contributors">
              <p>社区</p>
            </a>
          
            <a href="/archives/"
              
              
              id="archives">
              <p>博客</p>
            </a>
          
            <a href="https://github.com/volantis-x/hexo-theme-volantis/"
              
              
              id="https:githubcomvolantis-xhexo-theme-volantis">
              <p>源码</p>
            </a>
          
        
      </div>
    </div>
  </div>
</div>

          <div class="scroll-down" style="display: none;"><i class="fa fa-chevron-down scroll-down-effects"></i></div>
        </div>
    
  
  </div>
  
    <div class='safearea'>
      <div class='body-wrapper' id="pjax-container">
        
          <!--此文件用来存放一些不方便取值的变量--> 
<!--思路大概是将值藏到重加载的区域内--> 
 
 
 
<div id="pjax-data" style="display: none"> 
  <div id="pjax-ispage">true</div> 
  <div id="pjax-pageTitle">python cookbook</div> 
  <div id="pjax-enable-cover">true</div> 
  <div id="pjax-comment-path"></div> 
  <div id="pjax-comment-placeholder"></div> 
</div> 
 
 
<script> 
  // 处理封面 此时 jquery 还没加载 
  if ("half" == "none") { // 移除封面 
    document.getElementsByClassName('cover-wrapper')[0].style.display = "none"; 
    document.getElementsByClassName('l_header', 'cover-wrapper')[0].classList.add("show"); 
  } else { 
    if ("half" == "half") { // 半屏 
      document.getElementsByClassName('cover-wrapper')[0].setAttribute('id', 'half'); 
      document.getElementsByClassName('scroll-down')[0].style.display = "none"; 
    } else if ("half" == "full") { // 全屏 
      document.getElementsByClassName('cover-wrapper')[0].setAttribute('id', 'full'); 
      document.getElementsByClassName('scroll-down')[0].style.display = ""; 
    } 
    document.getElementsByClassName('cover-wrapper')[0].style.display = ""; 
    document.getElementsByClassName('l_header', 'cover-wrapper')[0].classList.remove("show"); 
  } 
</script> 
 

        
        

<div class='l_main'>
  <article class="article post white-box reveal md shadow article-type-post" id="post" itemscope itemprop="blogPost">
  


  
  <div class="article-meta" id="top">
    
    
    
      <h1 class="title">
        python cookbook
      </h1>
      <div class='new-meta-box'>
        
          
            
<div class='new-meta-item author'>
  <a class='author' href="/" rel="nofollow">
    <img no-lazy src="">
    <p>玖玖</p>
  </a>
</div>

          
        
          
            
  <div class='new-meta-item category'>
    <a class='notlink'>
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <a class="category-link" href="/categories/python/">python</a>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：Dec 1, 2019</p>
  </a>
</div>

          
        
          
            
  <div class="new-meta-item browse leancloud">
    <a class='notlink'>
      
      <div id="lc-pv" data-title="python cookbook" data-path="/2019/12/01/python-cookbook/">
        <i class="fas fa-eye fa-fw" aria-hidden="true"></i>
        <span id='number'><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span>
        次浏览
      </div>
    </a>
  </div>


          
        
          
            
  <div class="new-meta-item wordcount">
    <a class='notlink'>
      <i class="fas fa-keyboard fa-fw" aria-hidden="true"></i>
      <p>11.1k words</p>
    </a>
  </div>
  <div class="new-meta-item readtime">
    <a class='notlink'>
      <i class="fas fa-hourglass-half fa-fw" aria-hidden="true"></i>
      <p>48 min</p>
    </a>
  </div>


          
        
      </div>
    
  </div>


  
  <excerpt in="" index="" |="" 首页摘要=""> 

<p><a href="https://python3-cookbook.readthedocs.io/zh_CN/latest/index.html" target="_blank" rel="noopener">python cookbook</a>的阅读笔记，对内容进行了简练。将常用的知识点记录下来。</p>
<a id="more"></a>
<the rest="" of="" contents="" |="" 余下全文="">

<h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><h3 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h3><h4 id="字典的构造方式"><a href="#字典的构造方式" class="headerlink" title="字典的构造方式"></a>字典的构造方式</h4><pre><code class="python"># a,b,c是常用的方式
a = dict(one=1, two=2, three=3) # 注意 one、two、three表示字符串，不用加引号
b = {&#39;one&#39;: 1, &#39;two&#39;: 2, &#39;three&#39;: 3}
c = dict(zip([&#39;one&#39;, &#39;two&#39;, &#39;three&#39;], [1, 2, 3]))
d = dict([(&#39;two&#39;, 2), (&#39;one&#39;, 1), (&#39;three&#39;, 3)])
e = dict({&#39;three&#39;: 3, &#39;one&#39;: 1, &#39;two&#39;: 2})
a == b == c == d == e # True
</code></pre>
<h4 id="字典键值的获取"><a href="#字典键值的获取" class="headerlink" title="字典键值的获取"></a>字典键值的获取</h4><pre><code class="python">one = a[&#39;four&#39;] # 键不存在时，会报错KeyError，因此推荐get方法，设置默认值
one = a.get(&#39;four&#39;)
# None
one=a.get(&#39;four&#39;,4) # get(key [,default])
# 4
</code></pre>
<h4 id="字典键值的添加"><a href="#字典键值的添加" class="headerlink" title="字典键值的添加"></a>字典键值的添加</h4><pre><code class="python">a[&#39;key&#39;] = value
a.setdefault(&quot;key&quot;[,default])   # 不要被这个名字给骗了，注意不会使用default修改原来的值
# 如果key在字典中，返回他的value. If not, 插入该键，设置为default 并返回 default。default 默认是 None。注意不会使用default修改原来的值。
</code></pre>
<p>个人觉得与get的差别只有 不存在给定的键时会不会在字典中添加该键。</p>
<p>例子</p>
<pre><code class="python">strings = (&#39;puppy&#39;, &#39;kitten&#39;, &#39;puppy&#39;, &#39;puppy&#39;,&#39;weasel&#39;, &#39;puppy&#39;, &#39;kitten&#39;, &#39;puppy&#39;)
counts = {}
for kw in strings:
    # counts[kw] += 1 会抛出KeyError异常
    counts[kw] = counts.setdefault(kw, 0) + 1
    # counts[kw] = counts.get(kw, 0) + 1 效果相同
</code></pre>
<h4 id="设置默认值"><a href="#设置默认值" class="headerlink" title="设置默认值"></a>设置默认值</h4><p>有没有一种字典它本身提供了默认值的功能呢？答案是肯定的，那就是 <code>collections.defaultdict</code> 。</p>
<p>定义：<code>defaultdict</code>([<em>default_factory</em>[, <em>…</em>]])</p>
<blockquote>
<p><code>default_factory</code>：必须是<code>callable</code>类型，因此可以是类型（如int、list）、函数。在 <a href="https://docs.python.org/3/library/collections.html#collections.defaultdict.__missing__" target="_blank" rel="noopener"><code>__missing__()</code></a> 方法中会使用default_factory ; default_factory使用第一个参数初始化，否则为None。</p>
<p><code>__missing__</code>：在调用 <a href="https://docs.python.org/3/reference/datamodel.html#object.__getitem__" target="_blank" rel="noopener"><code>__getitem__()</code></a> 方法或者<code>dict[key]</code>未找到key时，会调用<code>__missing__</code>(<em>key</em>)方法。 如果default_factory 是 None，则抛出异常。如果不是None，则为给定键提供默认值，插入到字典中，并返回。</p>
</blockquote>
<p>注意：这种形式的默认值只有在通过 <code>dict[key]</code>或者 <code>dict.__getitem__(key)</code> 访问的时候才有效。</p>
<p><strong>default_factory：类型</strong></p>
<pre><code class="python">from collections import defaultdict
s = &#39;mississippi&#39;
d = defaultdict(int) # 默认为0
for k in s:
     d[k] += 1

sorted(d.items())
# [(&#39;i&#39;, 4), (&#39;m&#39;, 1), (&#39;p&#39;, 2), (&#39;s&#39;, 4)]
</code></pre>
<pre><code class="python">from collections import defaultdict
s = [(&#39;yellow&#39;, 1), (&#39;blue&#39;, 2), (&#39;yellow&#39;, 3), (&#39;blue&#39;, 4), (&#39;red&#39;, 1)]
d = defaultdict(list)
for k, v in s:
     d[k].append(v)

sorted(d.items())
[(&#39;blue&#39;, [2, 4]), (&#39;red&#39;, [1]), (&#39;yellow&#39;, [1, 3])]
</code></pre>
<p><strong>default_factory：函数、lambda 函数</strong></p>
<pre><code class="python"># 提供函数
from collections import defaultdict
def constant_factory(value):
    return lambda: value

d = defaultdict(constant_factory(&#39;&lt;missing&gt;&#39;)) # 
d.update(name=&#39;John&#39;, action=&#39;ran&#39;)
print(&#39;%(name)s %(action)s to %(object)s&#39; % d)
# &#39;John ran to &lt;missing&gt;&#39;
</code></pre>
<pre><code class="python"># 提供lambda 函数
from collections import defaultdict
s = &#39;mississippi&#39;
d = defaultdict(lambda : 0) # 默认为0
for k in s:
     d[k] += 1

sorted(d.items())
# [(&#39;i&#39;, 4), (&#39;m&#39;, 1), (&#39;p&#39;, 2), (&#39;s&#39;, 4)]
</code></pre>
<h3 id="队列与堆"><a href="#队列与堆" class="headerlink" title="队列与堆"></a>队列与堆</h3><h4 id="deque队列"><a href="#deque队列" class="headerlink" title="deque队列"></a>deque队列</h4><ul>
<li>在队列<strong>两端插入或删除</strong>元素时间复杂度都是 <code>O(1)</code> ，区别于列表，在列表的开头插入或删除元素的时间复杂度为 <code>O(N)</code> 。</li>
</ul>
<pre><code class="python">from collections import deque
&gt;&gt;&gt; q = deque()
&gt;&gt;&gt; q.append(1)
&gt;&gt;&gt; q.append(2)
&gt;&gt;&gt; q.append(3)
&gt;&gt;&gt; q
deque([1, 2, 3])
&gt;&gt;&gt; q.appendleft(4)
</code></pre>
<ul>
<li>使用 <code>deque(maxlen=N)</code> 构造函数会新建一个固定大小的队列。当新的元素加入并且这个队列已满的时候， 最老的元素会自动被移除掉。</li>
</ul>
<pre><code>&gt;&gt;&gt; q = deque(maxlen=3)
&gt;&gt;&gt; q.append(1)
&gt;&gt;&gt; q.append(2)
&gt;&gt;&gt; q.append(3)
&gt;&gt;&gt; q
deque([1, 2, 3], maxlen=3)
&gt;&gt;&gt; q.append(4)
&gt;&gt;&gt; q
deque([2, 3, 4], maxlen=3)
&gt;&gt;&gt; q.append(5)
&gt;&gt;&gt; q
deque([3, 4, 5], maxlen=3)
</code></pre><h4 id="heapq堆-TODO"><a href="#heapq堆-TODO" class="headerlink" title="heapq堆(TODO )"></a>heapq堆(TODO )</h4><p>在底层实现里面，首先会先将集合数据<strong>进行堆排序后放入一个列表中</strong></p>
<h3 id="解压赋值、星号表达式"><a href="#解压赋值、星号表达式" class="headerlink" title="解压赋值、星号表达式"></a>解压赋值、星号表达式</h3><h4 id="解压赋值给多个变量"><a href="#解压赋值给多个变量" class="headerlink" title="解压赋值给多个变量"></a>解压赋值给多个变量</h4><ul>
<li><p>任何的序列（或者是可迭代对象）可以通过一个简单的赋值语句解压并赋值给多个变量。 唯一的前提就是<strong>变量的数量必须跟序列元素的数量是一样的。</strong></p>
</li>
<li><p>解压赋值可以用在<strong>任何可迭代对象</strong>上面，而不仅仅是列表或者元组。 包括字符串，文件对象，迭代器和生成器。</p>
</li>
</ul>
<pre><code>s = &#39;Hello&#39;
a, b, c, d, e = s
</code></pre><ul>
<li>你可能只想解压一部分，丢弃其他的值。可以使用任意变量名去占位，到时候丢掉这些变量就行了，最常用的占位符就<code>_</code>。</li>
</ul>
<pre><code>data = [ &#39;ACME&#39;, 50, 91.1, (2012, 12, 21) ]
_, shares, price, _ = data
</code></pre><h4 id="变量与星号"><a href="#变量与星号" class="headerlink" title="变量与星号"></a>变量与星号</h4><p>扩展的迭代解压语法是专门<strong>为解压不确定个数或任意个数元素的可迭代对象</strong>而设计的。</p>
<p>假设你现在有一些用户的记录列表，每条记录包含一个名字、邮件，接着就是<u>不确定数量</u>的电话号码。 你可以像下面这样分解这些记录：</p>
<pre><code class="python"># 可以解压元组
record = (&#39;Dave&#39;, &#39;dave@example.com&#39;, &#39;773-555-1212&#39;, &#39;847-555-1212&#39;)
name, email, *phone_numbers = record
print(name)             #&#39;Dave&#39;
print(email)            #&#39;dave@example.com&#39;
print(phone_numbers)    # [&#39;773-555-1212&#39;, &#39;847-555-1212&#39;]
</code></pre>
<p>你有一个公司前 8 个月销售数据的序列， 但是你想看下最近一个月数据和前面 7 个月的平均值的对比。</p>
<pre><code class="python"># 可以解压列表
*trailing, current = [10, 8, 7, 1, 9, 5, 10, 3]
print(trailing)            # [10, 8, 7, 1, 9, 5, 10]
print(current)            `# 3
trailing_avg = sum(trailing_qtrs) / len(trailing_qtrs)
</code></pre>
<p>在学期末的时候， 统计家庭作业的平均成绩，但是排除掉第一个和最后一个分数。</p>
<pre><code>first, *middle, last = grades
avg(middle)
</code></pre><p><strong>星号<code>*</code>解压出的变量永远都是list列表类型</strong> ，不管解压的数量是多少(包括 0 个)。试着理解下面这些容易让人困惑的点：</p>
<ul>
<li><p><code>*elements = iterable</code> 会让 <code>elements</code> 变为 list 类型；</p>
</li>
<li><p>但是 <code>elements = *iterable,</code> 会让 <code>elements</code> 变成 tuple类型</p>
<blockquote>
<p>因为这等价于<code>elements= e1,e2...en,</code>(e是iterable对象中的元素)，<code>e1,e2...en,</code>就是tuple类型，试试这个<code>a=1,</code>，a就成了一个tuple对象，等价于<code>a=(1,)</code></p>
</blockquote>
</li>
</ul>
<p>理解上面的以后，下面的就能理解了吧。</p>
<ul>
<li><p><code>first, *elements = *iterable,</code> ，elements是list类型</p>
</li>
<li><p><code>*elements, = *iterabl,</code> ，elements是list类型。</p>
<blockquote>
<p>注意：<code>*elements = *iterabl,</code></p>
<p>SyntaxError: starred assignment target must be in a list or tuple</p>
<p>报错提示：星号赋值的目标element必须在list、tuple中，因此像上面的写法（加个逗号）才是对的。</p>
</blockquote>
</li>
</ul>
<h4 id="函数与星号"><a href="#函数与星号" class="headerlink" title="函数与星号"></a>函数与星号</h4><p>一、函数定义中的星号</p>
<p>函数定义中的星号，<code>def func(a,*b)</code> 表示接受可变参数，分配给位置参数后剩下的参数(关键字参数、<code>**</code>解压的字典参数除外)会被封装为tuple。</p>
<p>整体的参数定义的<strong>顺序必须是：必选参数、默认参数、可变参数、命名关键字参数和关键字参数</strong>。</p>
<p>在一个函数的接收参数中，同时出现”非关键字参数（位置参数）”和”关键字参数”时，可以使用一个<strong>单星号</strong>来分隔这两种参数，这种叫做<strong>命名关键字参数</strong>。命名关键字参数可以有默认值，例子如下：</p>
<pre><code class="python">def mix(a,b,*,x,y=4):
    &quot;&quot;&quot;位置参数与命名关键字参数混合&quot;&quot;&quot;
    return a,b,x,y

# 星号前面的a和b是位置参数，星号后面的x和y是关键字参数，并且 x 有默认值
# 调用mix()函数并传入参数时，关键字参数一定要使用&quot;变量名=值&quot;的形式传入数据，如果同位置参数一样传入数据，就会引发一个TypeError异常

print(mix(1,2,x=3,y=4))
print(mix(1,2,x=3))
# print(mix(1,2,3,4)) 
# Error, mix() takes 2 positional arguments but 4 were given
</code></pre>
<p>如果函数定义中已经有了一个可变参数，后面跟着的命名关键字参数就不再需要一个特殊分隔符*了（<strong>func2中的 b 是命名关键字参数，不是默认参数</strong>），但是调用时必须显示指明给命名参数的赋值，否则会被可变参数全部接收，无法改变默认值。出现你意料之外的问题，如下例子：</p>
<pre><code class="python"># 位置参数，默认参数，可变参数
def func1(a,b=3,*c):
    print(vars())

func1(1,2,3,4)     # 2会赋值给默认参数b

# 位置参数，可变参数，命名关键字参数
def func2(a,*c,b=3):
    print(vars())

func2(1,2,3,4)     # 2，3，4全部被可变参数接收，默认参数b不会被改变
func2(1,2,3,b=4)   # 除非显示指定要改变默认参数

 # {&#39;c&#39;: (3, 4), &#39;b&#39;: 2, &#39;a&#39;: 1}
 # {&#39;c&#39;: (2, 3, 4), &#39;b&#39;: 3, &#39;a&#39;: 1}
 # {&#39;c&#39;: (2, 3), &#39;b&#39;: 4, &#39;a&#39;: 1}
</code></pre>
<p>综合的例子：</p>
<pre><code class="python"># a,b 是位置参数，c 是默认参数，d 是可变参数，e,f 是命名关键字参数，并且 e 有默认值，kw 是关键字参数
def func(a,b,c=1,*d,e=1,f,**kw):
    print(vars())

d={&#39;m&#39;:4}
func(*(1,2),3,*(4,5),6, e=2,f=3,**d,**{&#39;x&#39;: 2}, y=3,**{&#39;z&#39;: 3},g=5)
# 等价于如下：
func(1,2,3,4,5,6,e=2,f=3,**{&#39;m&#39;:4,&#39;x&#39;:2,&#39;y&#39;:3,&#39;z&#39;:3,&#39;g&#39;:5})
</code></pre>
<p>关键字参数和命名关键字参数的区别在于：<strong>前者可以传递任何名字的参数，而后者只能传递*后面名字的参数。</strong></p>
<p>二、函数调用时的星号</p>
<p>在调用函数时，<code>func(1,*[2,3,4,5])</code>， <code>*</code>操作符会将 iterable对象（如 list、 tuple）中的元素提取出来，就像他们是另外的位置参数，替换了原本iterable对象的位置，因此相当于<code>func(1,2,3,4,5)</code>，对于字典对象的解压也是一样的。</p>
<blockquote>
<p>在 version 3.5之前，只能接收一个<code>*</code> 和 <code>**</code> unpackings，之后( <a href="https://www.python.org/dev/peps/pep-0448" target="_blank" rel="noopener"><strong>PEP 448</strong></a>) 发生了一些改变： 函数调用时，允许接受<strong>任意多个</strong> <code>*</code> 和 <code>**</code> unpackings。</p>
</blockquote>
<p>因此在理解调用函数时出现的<code>*</code>与<code>**</code>，<strong>将他们替换为”位置参数”和”关键字参数”即可。</strong>因此在调用时，位置参数 与 <code>*</code> 表达式参数 没有位置顺序的限制 ，关键字参数 与<code>**</code>表达式参数也没有位置顺序的限制。</p>
<p>参数顺序问题：</p>
<p>函数调用也是遵循参数定义的顺序规则，关键字参数 必须在 位置参数 之后， <code>**</code> 表达式参数 在 <code>*</code> 表达式参数之后。</p>
<pre><code class="python"># 例子
def func(a,b,c=1,*d,e=1,**kw):
    print(vars())

d={&#39;m&#39;:4}

# 调用时的顺序，以及任意多个 unpacking 参数
func(*(1,2),3,*(4,5),6, e=2, **d,**{&#39;x&#39;: 2}, y=3,**{&#39;z&#39;: 3},f=5)
# 等价于 func(1,2,3,4,5,6,e=2,{&#39;m&#39;:4,&#39;x&#39;:2,&#39;y&#39;:3,&#39;z&#39;:3,&#39;f&#39;:5})  记住诀窍：将*与**替换为&quot;位置参数&quot;和&quot;关键字参数&quot;即可
</code></pre>
<p>虽然“<code>*</code>表达式参数“可以出现在”关键字参数”后面，但是 它会比“关键字参数”（<code>**</code>表达式）<strong>优先处理</strong> ，相当于python 帮你提前了。(在这里那个替换诀窍暂时不能用。)</p>
<pre><code class="python">def f(a, b):
    print(a, b)
f(1, *(2,))
# 1 2

f(b=1, *(2,))
# 2 1

f(a=1, *(2,)) # 2先被赋值给 a，因此 a=1 会导致重复赋值
# TypeError: f() got multiple values for keyword argument &#39;a&#39;
</code></pre>
<p>重复键问题：</p>
<p>字典与Function 对待重复键是不同的，字典允许重复键，但函数会引发error。比如如果一个位置参数<code>def func(a)</code> 通过 位置、关键字这两种方法提供了值<code>func(1,a=3)</code>就会引发错误；使用 <code>**</code> unpackings引起得出重复，比如 <code>f(**{&#39;x&#39;: 2},**{&#39;x&#39;: 3})</code>，也会引发错误。</p>
<h4 id="zip与星号"><a href="#zip与星号" class="headerlink" title="zip与星号(*)"></a>zip与星号(*)</h4><p>zip 方法在 Python 2 和 Python 3 中的不同：</p>
<ul>
<li>在 Python 3 中为了减少内存，zip() 返回的是一个对象。如需展示列表，需手动 list() 转换。</li>
<li>在python3中（<strong>有个大坑</strong>），处于优化内存的考虑，<strong>只能访问一次</strong>(操作一次），内存就会释放</li>
</ul>
<ol>
<li><p>如果各个迭代器的元素个数不一致，则返回列表长度与最短的对象相同</p>
<pre><code class="python"> a = [1,2,3]
 b = [4,5,6]
 c = [7,8,9,10,11]

 lis=list(zip(a,b,c)) 
 print(lis)
 # [(1, 4, 7), (2, 5, 8), (3, 6, 9)]
</code></pre>
</li>
<li><p>星号*进行解压，解压的效果：提取iterable对象内的元素</p>
<pre><code class="python">a = [1,2,3]
b = [4,5,6]
zipped_list = list(zip(a,b))
print(zipped_list) 
print(*zipped_list)
# [(1, 4), (2, 5), (3, 6)]
# (1, 4) (2, 5) (3, 6)
</code></pre>
</li>
<li><p>zip 与 *zip 进行逆操作</p>
<pre><code class="python">a = [1,2,3]
b = [4,5,6]
lis = zip(a,b)   # [(1, 4), (2, 5), (3, 6)]
result = zip(*lis) # 等价于 zip( (1, 4), (2, 5), (3, 6) )
aa,bb = list(result)
print(aa,bb)
# (1, 2, 3), (4, 5, 6) 又获得原来的a、b
</code></pre>
</li>
</ol>
<h2 id="字符串处理"><a href="#字符串处理" class="headerlink" title="字符串处理"></a>字符串处理</h2><h3 id="用Shell通配符匹配字符串"><a href="#用Shell通配符匹配字符串" class="headerlink" title="用Shell通配符匹配字符串"></a>用Shell通配符匹配字符串</h3><p><code>fnmatch</code> 模块提供了两个函数—— <code>fnmatch()</code> 和 <code>fnmatchcase()</code> ，可以用 <strong>Unix Shell</strong> 中常用的通配符(比如 <code>*.py</code> , <code>Dat[0-9]*.csv</code> 等)去匹配文本字符串。</p>
<p><code>fnmatch()</code> 函数匹配能力介于简单的字符串方法和强大的正则表达式之间。 如果在数据处理操作中只需要简单的通配符就能完成的时候，这通常是一个比较合理的方案。</p>
<p>如果你的代码需要做文件名的匹配，最好使用 <code>glob</code> 模块。参考5.13小节。</p>
<pre><code class="python">from fnmatch import fnmatch, fnmatchcase

print(fnmatch(&#39;foo.txt&#39;, &#39;*.txt&#39;))
print(fnmatch(&#39;foo.txt&#39;, &#39;?oo.txt&#39;))
print(fnmatch(&#39;Dat45.csv&#39;, &#39;Dat[0-9]*&#39;))
names = [&#39;Dat1.csv&#39;, &#39;Dat2.csv&#39;, &#39;config.ini&#39;, &#39;foo.py&#39;]
[name for name in names if fnmatch(name, &#39;Dat*.csv&#39;)]
# True
# True
# True
# [&#39;Dat1.csv&#39;, &#39;Dat2.csv&#39;]
</code></pre>
<p><code>fnmatch()</code> 函数使用<strong>底层操作系统的大小写敏感规则</strong>(不同的系统是不一样的)来匹配模式。比如：</p>
<pre><code># On OS X (Mac)
fnmatch(&#39;foo.txt&#39;, &#39;*.TXT&#39;)
# False
# On Windows
fnmatch(&#39;foo.txt&#39;, &#39;*.TXT&#39;)
# True
</code></pre><p>如果你对这个区别很在意，可以使用 <code>fnmatchcase()</code> 来代替。它完全使用你的模式大小写匹配。比如：</p>
<pre><code>fnmatchcase(&#39;foo.txt&#39;, &#39;*.TXT&#39;)
# False
</code></pre><h3 id="正则表达式匹配字符串"><a href="#正则表达式匹配字符串" class="headerlink" title="正则表达式匹配字符串"></a>正则表达式匹配字符串</h3><p>如果你想匹配的是字面字符串，那么你通常只需要调用<u>基本字符串方法</u>就行， 比如 <code>str.find()</code> , <code>str.endswith()</code> , <code>str.startswith()</code> 或者类似的方法。</p>
<p>对于复杂的匹配需要使用正则表达式和 <code>re</code> 模块， 核心步骤就是先使用 <code>re.compile()</code> 编译正则表达式字符串， 然后使用 <code>match()</code> , <code>search()</code>,<code>findall()</code> 或者 <code>finditer()</code> 等方法。</p>
<blockquote>
<p>需要注意的是 <code>match()</code> 方法仅仅检查字符串的从头开始部分，出现在字符串中间的子串不会匹配到。它的匹配结果有可能并不是你期望的那样。</p>
</blockquote>
<p>如果你仅仅是做一次简单的文本匹配/搜索操作的话，可以略过编译部分，直接使用 <code>re</code> 模块级别的函数。如果你打算做大量的匹配和搜索操作的话，最好先编译正则表达式，然后再重复使用它。 </p>
<blockquote>
<p>模块级别的函数会将<strong>最近编译过的模式缓存起来</strong>，因此并不会消耗太多的性能， 但是如果使用预编译模式的话，你将会进一步减少查找和一些额外的处理损耗。</p>
</blockquote>
<p>当写正则式字符串的时候，相对普遍的做法是使用原始字符串比如 <code>r&#39;(\d+)/(\d+)/(\d+)&#39;</code> 。 这种字符串将不去解析反斜杠，这在正则表达式中是很有用的。 如果不这样做的话，你必须使用两个反斜杠，类似 <code>&#39;(\\d+)/(\\d+)/(\\d+)&#39;</code> 。</p>
<h3 id="字符串搜索和替换"><a href="#字符串搜索和替换" class="headerlink" title="字符串搜索和替换"></a>字符串搜索和替换</h3><p>对于简单的字面模式，直接使用 <code>str.replace()</code> 方法即可，对于复杂的模式，请使用 <code>re</code> 模块中的 <code>sub()</code> 函数。如将形式为 <code>11/27/2012</code> 的日期字符串改成 <code>2012-11-27</code> 。示例如下：</p>
<pre><code class="python">import re
text = &#39;Today is 11/27/2012. PyCon starts 3/13/2013.&#39;
re.sub(r&#39;(\d+)/\d+)/(\d+)&#39;, r&#39;\3-\1-\2&#39;, text)
# &#39;Today is 2012-11-27. PyCon starts 2013-3-13.&#39;
</code></pre>
<p><code>sub()</code> 函数中的第一个参数是被匹配的模式，第二个参数是替换模式。反斜杠数字比如 <code>\3</code> 指向前面模式的捕获组号。</p>
<p><code>sub()</code> 函数除了接受替换字符串外，还能接受一个回调函数。</p>
<pre><code class="python">import re
text = &#39;UPPER PYTHON, lower python, Mixed Python&#39;
re.findall(&#39;python&#39;, text, flags=re.IGNORECASE)
# [&#39;PYTHON&#39;, &#39;python&#39;, &#39;Python&#39;]

re.sub(&#39;python&#39;, &#39;snake&#39;, text, flags=re.IGNORECASE) # 替换为字符串
# &#39;UPPER snake, lower snake, Mixed snake&#39;

def matchcase(word):
    # 定义 处理不同match时替换为不同的字符串 的函数
    def replace(m):
        text = m.group()
        if text.isupper():
            return word.upper()
        elif text.islower():
            return word.lower()
        elif text[0].isupper():
            return word.capitalize()
        else:
            return word
    return replace

re.sub(&#39;python&#39;, matchcase(&#39;snake&#39;), text, flags=re.IGNORECASE) # 使用回调函数
# &#39;UPPER SNAKE, lower snake, Mixed Snake&#39;
</code></pre>
<h3 id="多行匹配模式"><a href="#多行匹配模式" class="headerlink" title="多行匹配模式"></a>多行匹配模式</h3><pre><code class="python">import re
comment = re.compile(r&#39;/\*(.*?)\*/&#39;)
text1 = &#39;/* this is a comment */&#39;
text2 = &#39;&#39;&#39;/* this is a
multiline comment */
&#39;&#39;&#39;
comment.findall(text1)
# [&#39; this is a comment &#39;]
comment.findall(text2)
# []

re.compile(r&#39;/\*(.|\n)*?\*/&#39;)
</code></pre>
<h3 id="将Unicode文本标准化-统一unicode文本"><a href="#将Unicode文本标准化-统一unicode文本" class="headerlink" title="将Unicode文本标准化(统一unicode文本)"></a>将Unicode文本标准化(统一unicode文本)</h3><p>处理Unicode字符串，需要<strong>确保所有字符串在底层有相同的表示</strong>。</p>
<p>因为在Unicode中，<strong>某些字符能够用多个合法的编码表示</strong>。为了说明，考虑下面的这个例子：</p>
<pre><code class="python">s1 = &#39;Spicy Jalape\u00f1o&#39;
s2 = &#39;Spicy Jalapen\u0303o&#39;
print(s1)
# &#39;Spicy Jalapeño&#39;
print(s1)
# &#39;Spicy Jalapeño&#39;
s1 == s2
# False
len(s1)
# 14
len(s2)
# 15
</code></pre>
<p>为了修正这个问题，你可以使用unicodedata模块先将文本标准化：</p>
<pre><code class="python">import unicodedata
t1 = unicodedata.normalize(&#39;NFC&#39;, s1)
t2 = unicodedata.normalize(&#39;NFC&#39;, s2)
print(t1 == t2)
# True
print(ascii(t1))
&#39;Spicy Jalape\xf1o&#39;
t3 = unicodedata.normalize(&#39;NFD&#39;, s1)
t4 = unicodedata.normalize(&#39;NFD&#39;, s2)
print(t3 == t4)
# True
print(ascii(t3))
# &#39;Spicy Jalapen\u0303o&#39;
</code></pre>
<h4 id="标准化的标准"><a href="#标准化的标准" class="headerlink" title="标准化的标准"></a>标准化的标准</h4><p><code>normalize()</code> 第一个参数指定字符串标准化的方式。 NFC表示<strong>字符应该是整体</strong>组成(比如可能的话就使用单一编码，会把’eu0301’2个字节压缩到1个字节’é’。)，而NFD表示字符应该<strong>分解为多个组合字符</strong>表示。</p>
<p>python同样支持扩展的标准化形式NFKC和NFKD，它们在处理某些字符的时候增加了额外的兼容特性。比如：</p>
<pre><code class="python">s = &#39;\ufb01&#39; # 一个单字节的字符
&#39;ﬁ&#39;
unicodedata.normalize(&#39;NFD&#39;, s)
&#39;ﬁ&#39;
# 注意组合的字符如何被分解
unicodedata.normalize(&#39;NFKD&#39;, s)
&#39;fi&#39;
unicodedata.normalize(&#39;NFKC&#39;, s)
&#39;fi&#39;
</code></pre>
<h4 id="处理和音字符（TODO-2-12还没看）"><a href="#处理和音字符（TODO-2-12还没看）" class="headerlink" title="处理和音字符（TODO 2.12还没看）"></a>处理和音字符（TODO 2.12还没看）</h4><p>在清理和过滤文本的时候字符的标准化也是很重要的。 比如，假设你想清除掉一些文本上面的变音符的时候(可能是为了搜索和匹配)：</p>
<pre><code class="python">t1 = unicodedata.normalize(&#39;NFD&#39;, s1)
&#39;&#39;.join(c for c in t1 if not unicodedata.combining(c))
&#39;Spicy Jalapeno&#39;
</code></pre>
<p>最后一个例子展示了 <code>unicodedata</code> 模块的另一个重要方面，也就是测试字符类的工具函数。<strong><code>combining()</code> 函数可以测试一个字符是否为和音字符。</strong></p>
<h4 id="正则中匹配unicode字符"><a href="#正则中匹配unicode字符" class="headerlink" title="正则中匹配unicode字符"></a>正则中匹配unicode字符</h4><p>如果你想在模式中包含指定的Unicode字符，你可以使用Unicode字符对应的转义序列(比如 <code>\uFFF</code>或者 <code>\UFFFFFFF</code> )。 </p>
<p>下面是一个匹配几个不同<u>阿拉伯编码页面</u>中所有字符的正则表达式：</p>
<pre><code class="python">&gt;&gt;&gt; arabic = re.compile(&#39;[\u0600-\u06ff\u0750-\u077f\u08a0-\u08ff]+&#39;)
</code></pre>
<h4 id="注意大小写转换问题"><a href="#注意大小写转换问题" class="headerlink" title="注意大小写转换问题"></a>注意大小写转换问题</h4><p>当执行匹配和搜索操作的时候，最好是先标准化并且清理所有文本为标准化格式。 但是同样也应该注意一些特殊情况，比如在忽略大小写匹配和大小写转换时的行为。</p>
<pre><code class="python">pat = re.compile(&#39;stra\u00dfe&#39;, re.IGNORECASE)
s = &#39;straße&#39;
pat.match(s) # 匹配成功
# &lt;_sre.SRE_Match object at 0x10069d370&gt;
pat.match(s.upper()) # 匹配失败
s.upper() # Case folds
# &#39;STRASSE&#39;
</code></pre>
<h3 id="删除字符串中空白字符（不需要的字符）"><a href="#删除字符串中空白字符（不需要的字符）" class="headerlink" title="删除字符串中空白字符（不需要的字符）"></a>删除字符串中空白字符（不需要的字符）</h3><h4 id="开始、结束的字符"><a href="#开始、结束的字符" class="headerlink" title="开始、结束的字符"></a>开始、结束的字符</h4><p>用于删除开始或结尾的字符，默认情况下，<code>strip、lstrip、rstrip</code>方法会去除空白字符，但是你也可以指定其他字符，<strong>注意strip()指定其他字符的使用，只要在开始或者结尾位置的字符符合指定的字符之一，就会被删除。</strong></p>
<pre><code class="python">t = &#39;---=-hello===-=&#39;
t.lstrip(&#39;-&#39;)
# &#39;=-hello===-=&#39;

t.rstrip(&#39;=&#39;)
# &#39;---=-hello==-&#39;

t.strip(&#39;-=&#39;)   #注意该情况
# &#39;hello&#39;
</code></pre>
<h4 id="中间的字符"><a href="#中间的字符" class="headerlink" title="中间的字符"></a>中间的字符</h4><p>如果你<strong>想处理中间的空格</strong>，那么你需要求助其他技术。比如使用 <code>replace()</code> 方法或者是用正则表达式替换。示例如下：</p>
<pre><code class="python">s.replace(&#39; &#39;, &#39;&#39;)
# &#39;helloworld&#39;
import re
re.sub(&#39;\s+&#39;, &#39; &#39;, s)
# &#39;hello world&#39;
</code></pre>
<h4 id="strip与生成器"><a href="#strip与生成器" class="headerlink" title="strip与生成器"></a>strip与生成器</h4><p>通常情况下你想将字符串 <code>strip</code> 操作和其他迭代操作相结合，比如从文件中读取多行数据。 如果是这样的话，那么生成器表达式就可以大显身手了。比如：</p>
<pre><code class="python">with open(filename) as f:
    lines = (line.strip() for line in f)
    for line in lines:
        print(line)
</code></pre>
<p>在这里，表达式 <code>lines = (line.strip() for line in f)</code> 执行数据转换操作。 <strong>这种方式非常高效</strong>，因为它不需要预先读取所有数据放到一个临时的列表中去。 它仅仅只是创建一个生成器，并且每次返回行之前会先执行 <code>strip</code> 操作。</p>
<h3 id="字符串对齐"><a href="#字符串对齐" class="headerlink" title="字符串对齐"></a>字符串对齐</h3><p>结论：优先选择 <code>format()</code> 函数或者方法。</p>
<ul>
<li><code>format()</code> 要比 <code>%</code> 操作符的功能更为强大。</li>
<li><code>format()</code> 也比使用 <code>ljust()</code> , <code>rjust()</code> 或 <code>center()</code> 方法更通用(<em>使用 <code>&lt;,&gt;</code> 或者 <code>^</code> 字符后面紧跟一个指定的宽度</em>)， 因为它可以用来格式化任意对象，而不仅仅是字符串。</li>
</ul>
<pre><code class="python">text = &#39;Hello World&#39;

# 用空格对齐
format(text, &#39;&lt;20&#39;)   # 等价于 text.ljust(20) 
# &#39;Hello World         &#39;
format(text, &#39;&gt;20&#39;)   # 等价于 text.rjust(20)
# &#39;         Hello World&#39;
format(text, &#39;^20&#39;)   # 等价于 text.center(20)
# &#39;    Hello World     &#39;

# 用指定字符对齐
format(text, &#39;=&gt;20&#39;)  # 等价于 text.rjust(20,&#39;=&#39;)
# &#39;=========Hello World&#39;
format(text, &#39;*^20&#39;)  # 等价于 text.center(20,&#39;*&#39;)
# &#39;****Hello World*****&#39;
</code></pre>
<p>当格式化多个值的时候，这些格式代码也可以被用在 <code>format()</code> 方法中。比如：</p>
<pre><code class="python">&#39;{:&gt;10s} {:&gt;10s}&#39;.format(&#39;Hello&#39;, &#39;World&#39;)
# &#39;     Hello      World&#39;
</code></pre>
<h3 id="合并拼接字符串"><a href="#合并拼接字符串" class="headerlink" title="合并拼接字符串"></a>合并拼接字符串</h3><h4 id="推荐使用-join"><a href="#推荐使用-join" class="headerlink" title="推荐使用 join"></a>推荐使用 join</h4><p>如果你仅仅只是合并少数几个字符串，使用加号(+)通常已经足够了。</p>
<p>如果你想要合并的字符串是在一个序列或者 <code>iterable</code> 中，那么最快的方式就是使用 <code>join()</code> 方法。</p>
<pre><code class="python">parts = [&#39;Is&#39;, &#39;Chicago&#39;, &#39;Not&#39;, &#39;Chicago?&#39;]
&#39; &#39;.join(parts)
# &#39;Is Chicago Not Chicago?&#39;
</code></pre>
<blockquote>
<p>初看起来，这种语法看上去会比较怪，但是 <code>join()</code> 被指定为字符串的一个方法。 这样做的部分原因是你想去连接的对象可能来自各种不同的数据序列(比如列表，元组，字典，文件，集合或生成器等)， 如果在所有这些对象上都定义一个 <code>join()</code>方法明显是冗余的。 </p>
</blockquote>
<p>一个相对比较聪明的技巧是<strong>利用生成器表达式</strong>转换数据为字符串的同时合并字符串，比如：</p>
<pre><code class="python">data = [&#39;ACME&#39;, 50, 91.1]
&#39;,&#39;.join(str(d) for d in data)
# &#39;ACME,50,91.1&#39;
</code></pre>
<h4 id="避免不必要的拼接"><a href="#避免不必要的拼接" class="headerlink" title="避免不必要的拼接"></a>避免不必要的拼接</h4><p>比如在打印的时候：</p>
<pre><code class="python">print(a + &#39;:&#39; + b + &#39;:&#39; + c) # Ugly
print(&#39;:&#39;.join([a, b, c])) # Still ugly
print(a, b, c, sep=&#39;:&#39;) # 推荐
</code></pre>
<p>当混合使用I/O操作和字符串连接操作的时候，有时候需要仔细研究你的程序。 比如，考虑下面的两端代码片段：</p>
<pre><code class="python"># Version 1 (string concatenation)
f.write(chunk1 + chunk2)

# Version 2 (separate I/O operations)
f.write(chunk1)
f.write(chunk2)
</code></pre>
<p>如果<strong>两个字符串很小，那么第一个版本性能会更好些</strong>，因为I/O系统调用天生就慢。 另外一方面，如果两个字符串很大，那么第二个版本可能会更加高效， 因为<strong>它避免了创建一个很大的临时结果并且要复制大量的内存块数据</strong>。</p>
<h3 id="以指定列宽-格式化字符串"><a href="#以指定列宽-格式化字符串" class="headerlink" title="以指定列宽 格式化字符串"></a>以指定列宽 格式化字符串</h3><p>使用 <code>textwrap</code> 模块来格式化字符串的输出</p>
<pre><code class="python">s = &quot;Look into my eyes, look into my eyes, the eyes, the eyes, the eyes, not around the eyes, don&#39;t look around the eyes, look into my eyes, you&#39;re under.&quot;
import textwrap
print(textwrap.fill(s, 70))
# Look into my eyes, look into my eyes, the eyes, the eyes, the eyes,
# not around the eyes, don&#39;t look around the eyes, look into my eyes,
# you&#39;re under.

print(textwrap.fill(s, 40))
# Look into my eyes, look into my eyes,
# the eyes, the eyes, the eyes, not around
# the eyes, don&#39;t look around the eyes,
# look into my eyes, you&#39;re under.

print(textwrap.fill(s, 40, initial_indent=&#39;    &#39;))
#     Look into my eyes, look into my
# eyes, the eyes, the eyes, the eyes, not
# around the eyes, don&#39;t look around the
# eyes, look into my eyes, you&#39;re under.

print(textwrap.fill(s, 40, subsequent_indent=&#39;    &#39;))
# Look into my eyes, look into my eyes,
#    the eyes, the eyes, the eyes, not
#    around the eyes, don&#39;t look around
#    the eyes, look into my eyes, you&#39;re
#    under.
</code></pre>
<p>当你希望输出自动匹配终端大小的时候。 你可以使用 <code>os.get_terminal_size()</code> 方法来获取终端的大小尺寸。比如：</p>
<pre><code class="python">import os
os.get_terminal_size().columns
</code></pre>
<p><code>fill()</code> 方法接受一些其他可选参数来控制tab，语句结尾等。 参阅 <a href="https://docs.python.org/3.6/library/textwrap.html#textwrap.TextWrapper" target="_blank" rel="noopener">textwrap.TextWrapper文档</a> 获取更多内容。</p>
<h3 id="在字符串中处理html和xml-TODO-未看"><a href="#在字符串中处理html和xml-TODO-未看" class="headerlink" title="在字符串中处理html和xml(TODO 未看)"></a>在字符串中处理html和xml(TODO 未看)</h3><p><a href="https://python3-cookbook.readthedocs.io/zh_CN/latest/c02/p17_handle_html_xml_in_text.html#htmlxml" target="_blank" rel="noopener">https://python3-cookbook.readthedocs.io/zh_CN/latest/c02/p17_handle_html_xml_in_text.html#htmlxml</a></p>
<h3 id="字符串令牌解析-TODO-未看"><a href="#字符串令牌解析-TODO-未看" class="headerlink" title="字符串令牌解析(TODO 未看)"></a>字符串令牌解析(TODO 未看)</h3><p><a href="https://python3-cookbook.readthedocs.io/zh_CN/latest/c02/p18_tokenizing_text.html" target="_blank" rel="noopener">https://python3-cookbook.readthedocs.io/zh_CN/latest/c02/p18_tokenizing_text.html</a></p>
<h2 id="数字日期和时间"><a href="#数字日期和时间" class="headerlink" title="数字日期和时间"></a>数字日期和时间</h2><h3 id="数字的四舍五入"><a href="#数字的四舍五入" class="headerlink" title="数字的四舍五入"></a>数字的四舍五入</h3><h4 id="简单的四舍五入"><a href="#简单的四舍五入" class="headerlink" title="简单的四舍五入"></a>简单的四舍五入</h4><p>使用内置的 <code>round(value, ndigits)</code> 函数即可。</p>
<p><strong>一、关于保留的位数</strong></p>
<p>传给 <code>round()</code> 函数的 <code>ndigits</code> 参数可以是<strong>负数</strong>，这种情况下， 舍入运算会作用在十位、百位、千位等上面。比如：</p>
<pre><code class="python">&gt;&gt;&gt; a = 1627731
&gt;&gt;&gt; round(a, -1)
1627730
&gt;&gt;&gt; round(a, -2)
</code></pre>
<p><strong>二、关于四舍五入</strong></p>
<pre><code>## python2 ##
round(0.5)
1.0

## python3 ##
round(0.5)
0
</code></pre><p>在python2.7的doc中，<code>round()</code>的最后写着保留值将保留到离上一位更近的一端（四舍六入），如果距离两端一样远，则保留到<strong>离0远的一边</strong>。所以round(0.5)会近似到1，而round(-0.5)会近似到-1。</p>
<blockquote>
<p>  Values are rounded to the closest multiple of 10 to the power minus <em>ndigits</em>; if two multiples are equally close, rounding is done away from 0</p>
</blockquote>
<p>但是到了python3.5的doc中，文档变成了如果距离两边一样远，会<strong>保留到偶数的一边</strong>。比如round(0.5)和round(-0.5)都会保留到0，而round(1.5)会保留到2。</p>
<blockquote>
<p>  values are rounded to the closest multiple of 10 to the power minus <em>ndigits</em>; if two multiples are equally close, rounding is done toward the even choice</p>
</blockquote>
<p><strong>三、关于精度问题</strong></p>
<pre><code>round(2.675, 2)
2.67
</code></pre><p><code>round(2.675, 2)</code>的结果，不论我们从python2还是3来看，结果都应该是2.68的，结果它偏偏是2.67，为什么？这跟浮点数的精度有关。我们知道在机器中浮点数不一定能精确表达，因为换算成一串1和0后可能是无限位数的，机器已经做出了截断处理。那么在<strong>机器中保存的2.675这个数字就比实际数字要小那么一点点</strong>。这一点点就导致了它离2.67要更近一点点，所以保留两位小数时就近似到了2.67。</p>
<p> <strong>总结</strong></p>
<p>以上。除非对精确度没什么要求，否则尽量避开用<code>round()</code>函数。近似计算我们还有其他的选择：</p>
<ol>
<li>使用math模块中的一些函数，比如<code>math.ceiling</code>（天花板除法）。</li>
<li>python自带整除，python2中是<code>/</code>，3中是<code>//</code>，还有<code>div</code>函数。</li>
<li>字符串格式化可以做截断使用，例如 <code>&quot;%.2f&quot; % value</code>（保留两位小数并变成字符串，如果还想用浮点数请披上<code>float()</code>的外衣）。</li>
<li>当然，对浮点数精度要求如果很高的话，请用decimal模块。</li>
</ol>
<p>参考 <a href="https://www.cnblogs.com/anpengapple/p/6507271.html" target="_blank" rel="noopener">https://www.cnblogs.com/anpengapple/p/6507271.html</a></p>
<h3 id="数值格式化指令"><a href="#数值格式化指令" class="headerlink" title="数值格式化指令"></a>数值格式化指令</h3><p>定宽度和精度的一般形式是 <code>&#39;[&lt;&gt;^]?width[,]?(.digits)?&#39;</code> ， 其中 <code>width</code> 和 <code>digits</code> 为整数，<code>？</code>代表可选部分。 同样的格式也被用在字符串的 <code>format()</code> 方法中。比如：</p>
<pre><code>&gt;&gt;&gt; &#39;The value is {:0,.2f}&#39;.format(x)
&#39;The value is 1,234.57&#39;
</code></pre><h3 id="进制"><a href="#进制" class="headerlink" title="进制"></a>进制</h3><h4 id="10-进制—-gt-其他"><a href="#10-进制—-gt-其他" class="headerlink" title="10 进制—&gt;其他"></a>10 进制—&gt;其他</h4><p><strong>带前缀的</strong></p>
<p>使用 <code>bin()</code> , <code>oct()</code> 或 <code>hex()</code> 函数</p>
<pre><code>&gt;&gt;&gt; x = 1234
&gt;&gt;&gt; bin(x)
&#39;0b10011010010&#39;
&gt;&gt;&gt; oct(x)
&#39;0o2322&#39;
&gt;&gt;&gt; hex(x)
&#39;0x4d2&#39;
&gt;&gt;&gt;
</code></pre><p><strong>没有前缀的</strong></p>
<p>如果不想输出 <code>0b</code> , <code>0o</code> 或者 <code>0x</code> 的前缀的话，可以使用 <code>format()</code> 函数</p>
<pre><code>&gt;&gt;&gt; format(x, &#39;b&#39;)
&#39;10011010010&#39;
&gt;&gt;&gt; format(x, &#39;o&#39;)
&#39;2322&#39;
&gt;&gt;&gt; format(x, &#39;x&#39;)
&#39;4d2&#39;
&gt;&gt;&gt;
</code></pre><h4 id="其他—-gt-10-进制"><a href="#其他—-gt-10-进制" class="headerlink" title="其他—&gt;10 进制"></a>其他—&gt;10 进制</h4><p>其他的进制转换整数，简单的使用带有进制的 <code>int()</code> 函数即可：</p>
<pre><code class="python">&gt;&gt;&gt; int(&#39;4d2&#39;, 16)
1234
&gt;&gt;&gt; int(&#39;10011010010&#39;, 2)
1234
</code></pre>
<p>字节到大整数的打包与解包</p>
<p><a href="https://python3-cookbook.readthedocs.io/zh_CN/latest/c03/p05_pack_unpack_large_int_from_bytes.html" target="_blank" rel="noopener">https://python3-cookbook.readthedocs.io/zh_CN/latest/c03/p05_pack_unpack_large_int_from_bytes.html</a></p>
<h3 id="无穷大与-NaN"><a href="#无穷大与-NaN" class="headerlink" title="无穷大与 NaN"></a>无穷大与 NaN</h3><p><strong>定义</strong></p>
<pre><code>&gt;&gt;&gt; a = float(&#39;inf&#39;)
&gt;&gt;&gt; b = float(&#39;-inf&#39;)
&gt;&gt;&gt; c = float(&#39;nan&#39;)
</code></pre><p><strong>检测</strong></p>
<p>测试是否为这些值，使用 <code>math.isinf()</code> 和 <code>math.isnan()</code> 函数。比如：</p>
<pre><code>&gt;&gt;&gt; math.isinf(a)
True
&gt;&gt;&gt; math.isnan(c)
True
&gt;&gt;&gt;
</code></pre><p><strong>传播</strong></p>
<p>无穷大数在执行数学计算的时候会传播</p>
<p>NaN值会在所有操作中传播，而不会产生异常</p>
<p>NaN值的一个特别的地方时它们之间的比较操作总是返回False。因此唯一安全的方法就是使用 <code>math.isnan()</code> </p>
<h3 id="分数运算"><a href="#分数运算" class="headerlink" title="分数运算"></a>分数运算</h3><p><a href="https://python3-cookbook.readthedocs.io/zh_CN/latest/c03/p08_calculating_with_fractions.html" target="_blank" rel="noopener">https://python3-cookbook.readthedocs.io/zh_CN/latest/c03/p08_calculating_with_fractions.html</a></p>
<h3 id="随机"><a href="#随机" class="headerlink" title="随机"></a>随机</h3><h4 id="随机小数"><a href="#随机小数" class="headerlink" title="随机小数"></a>随机小数</h4><p><code>random.random()</code>方法用于生成一个0到1的随机浮点数：<code>0&lt;=n&lt;1.0</code></p>
<p><code>random.uniform()</code> 计算均匀分布随机数,<code>0&lt;=n&lt;1.0</code></p>
<h4 id="随机整数"><a href="#随机整数" class="headerlink" title="随机整数"></a>随机整数</h4><p><code>random.randint(a,b)</code>：用于生成一个指定范围内的整数。其中生成的随机数n：a&lt;=n&lt;=b</p>
<p><code>random.randrange([start],stop[, step])</code>：从指定范围内，按指定基数递增的集合中获取一个随机数。如：<code>random.randrange(10,100,2)</code>，结果相当于从[10,12,14,16,…,96,98]序列中获取一个随机数。<code>random.randrange(10,100,2)</code>在结果上与<code>random.choice(range(10,100,2))</code>等效。</p>
<h4 id="随机选择数组中的1个"><a href="#随机选择数组中的1个" class="headerlink" title="随机选择数组中的1个"></a>随机选择数组中的1个</h4><pre><code class="python">&gt;&gt;&gt; print random.choice([&quot;JGood&quot;,&quot;is&quot;,&quot;a&quot;,&quot;handsome&quot;,&quot;body&quot;])
is
</code></pre>
<h4 id="随机选择数组中的-N个"><a href="#随机选择数组中的-N个" class="headerlink" title="随机选择数组中的 N个"></a>随机选择数组中的 N个</h4><p><code>random.sample(sequence,k)</code>：从指定序列中随机获取指定长度的片段，sample函数不会修改原有序列。</p>
<pre><code class="python">&gt;&gt;&gt; list=[1,2,3,4,5,6,7,8,9,10]
&gt;&gt;&gt; print random.sample(list,5) #从list中随机获取5个元素，作为一个片段返回
[1, 6, 10, 8, 3]
</code></pre>
<p><a href="https://www.cnblogs.com/chamie/p/4917820.html" target="_blank" rel="noopener">https://www.cnblogs.com/chamie/p/4917820.html</a></p>
<h3 id="时间处理"><a href="#时间处理" class="headerlink" title="时间处理"></a>时间处理</h3><h4 id="datetime-模块"><a href="#datetime-模块" class="headerlink" title="datetime 模块"></a>datetime 模块</h4><p><code>datetime</code> 模块，可以进行常规的加减计算。</p>
<pre><code>from datetime import datetime
a = datetime(2012, 9, 23)
b = datetime(2012, 9, 20)
print(a - b)
# 3 days, 0:00:00
</code></pre><p>为了表示一个时间段，可以创建一个 <code>timedelta</code> 实例，就像下面这样：</p>
<pre><code class="python">from datetime import timedelta
a = timedelta(days=2, hours=6)
b = timedelta(hours=4.5)
c = a + b
&gt;&gt;&gt; c.days
2
&gt;&gt;&gt; c.seconds
37800
&gt;&gt;&gt; c.total_seconds() / 3600
58.5
</code></pre>
<p>在计算的时候，需要注意的是 <code>datetime</code> 会自动处理闰年。</p>
<p><strong>高级库</strong></p>
<p>如果你需要执行更加复杂的日期操作，比如处理时区，模糊时间范围，节假日计算等等， 可以考虑使用 <a href="http://pypi.python.org/pypi/python-dateutil" target="_blank" rel="noopener">dateutil模块</a></p>
<h4 id="循环时间"><a href="#循环时间" class="headerlink" title="循环时间"></a>循环时间</h4><pre><code class="python">&gt;&gt;&gt; for d in date_range(datetime(2012, 9, 1), datetime(2012,10,1),
                        timedelta(hours=6)):
...     print(d)
...
2012-09-01 00:00:00
2012-09-01 06:00:00
</code></pre>
<p>这种实现之所以这么简单，还得归功于Python中的日期和时间能够使用标准的数学和比较操作符来进行运算。</p>
<h4 id="字符串与时间对象"><a href="#字符串与时间对象" class="headerlink" title="字符串与时间对象"></a>字符串与时间对象</h4><p><strong>字符串—&gt;时间：strptime</strong></p>
<pre><code class="python">&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; text = &#39;2012-09-20&#39;
&gt;&gt;&gt; y = datetime.strptime(text, &#39;%Y-%m-%d&#39;)
&gt;&gt;&gt; z = datetime.now()
&gt;&gt;&gt; diff = z - y
&gt;&gt;&gt; diff
datetime.timedelta(3, 77824, 177393)
</code></pre>
<p><strong>时间—&gt;字符串：strftime</strong></p>
<pre><code class="python">&gt;&gt;&gt; z
datetime.datetime(2012, 9, 23, 21, 37, 4, 177393)
&gt;&gt;&gt; nice_z = datetime.strftime(z, &#39;%A %B %d, %Y&#39;)
&gt;&gt;&gt; nice_z
&#39;Sunday September 23, 2012&#39;
</code></pre>
<h4 id="时区"><a href="#时区" class="headerlink" title="时区"></a>时区</h4><p><a href="https://python3-cookbook.readthedocs.io/zh_CN/latest/c03/p16_manipulate_dates_involving_timezone.html" target="_blank" rel="noopener">https://python3-cookbook.readthedocs.io/zh_CN/latest/c03/p16_manipulate_dates_involving_timezone.html</a></p>
<h2 id="迭代器与生成器"><a href="#迭代器与生成器" class="headerlink" title="迭代器与生成器"></a>迭代器与生成器</h2><h3 id="next函数"><a href="#next函数" class="headerlink" title="next函数"></a>next函数</h3><p>一、默认会抛出异常 <code>StopIteration</code> 用来指示迭代的结尾。</p>
<pre><code class="python">with open(&#39;/etc/passwd&#39;) as f:
        try:
            while True:
                line = next(f)
                print(line, end=&#39;&#39;)
        except StopIteration:
            pass
</code></pre>
<p>二、通过返回一个指定值来标记结尾</p>
<pre><code class="python">with open(&#39;/etc/passwd&#39;) as f:
    while True:
        line = next(f, None)   # 设置为不抛出异常，返回 None 的方式
        if line is None:
            break
        print(line, end=&#39;&#39;)
</code></pre>
<h2 id="文件与-IO"><a href="#文件与-IO" class="headerlink" title="文件与 IO"></a>文件与 IO</h2><h3 id="TODO-5-4，5-6，-5-8，5-9，5-10，5-18-5-20-略"><a href="#TODO-5-4，5-6，-5-8，5-9，5-10，5-18-5-20-略" class="headerlink" title="TODO 5.4，5.6， 5.8，5.9，5.10，5.18, 5.20(略)"></a>TODO 5.4，5.6， 5.8，5.9，5.10，5.18, 5.20(略)</h3><h3 id="读写文本文件"><a href="#读写文本文件" class="headerlink" title="读写文本文件"></a>读写文本文件</h3><h4 id="rt-wt-at模式"><a href="#rt-wt-at模式" class="headerlink" title="rt,wt,at模式"></a><code>rt,wt,at</code>模式</h4><p>使用带<code>t</code>的模式，文件的读写操作默认使用系统编码，可以通过调用 <code>sys.getdefaultencoding()</code> 来得到。 在大多数机器上面都是utf-8编码。</p>
<pre><code class="python">with open(&#39;somefile.txt&#39;, &#39;rt&#39;) as f:
    for line in f:
        # process line
        ...

with open(&#39;somefile.txt&#39;, &#39;wt&#39;) as f:
    f.write(text1)
    f.write(text2)
</code></pre>
<h4 id="x模式，文件不存在才能写入"><a href="#x模式，文件不存在才能写入" class="headerlink" title="x模式，文件不存在才能写入"></a><code>x</code>模式，文件不存在才能写入</h4><blockquote>
<p>  x模式是一个Python3对 <code>open()</code> 函数特有的扩展。 在Python的旧版本或者是Python实现的底层C函数库中都是没有这个模式的。</p>
</blockquote>
<p>可以在 <code>open()</code> 函数中使用 <code>x</code> 模式来代替 <code>w</code> 模式的方法来解决这个问题。比如：</p>
<pre><code>&gt;&gt;&gt; with open(&#39;somefile&#39;, &#39;wt&#39;) as f:
...     f.write(&#39;Hello\n&#39;)
...
&gt;&gt;&gt; with open(&#39;somefile&#39;, &#39;xt&#39;) as f:
...     f.write(&#39;Hello\n&#39;)
...
Traceback (most recent call last):
File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
FileExistsError: [Errno 17] File exists: &#39;somefile&#39;
&gt;&gt;&gt;
</code></pre><p>如果文件是二进制的，使用 <code>xb</code> 来代替 <code>xt</code></p>
<h4 id="文件对象的属性"><a href="#文件对象的属性" class="headerlink" title="文件对象的属性"></a>文件对象的属性</h4><pre><code class="python">with open(&quot;1.txt&quot;,&#39;rt&#39;) as f:
    print(f.name) # 读取的文件名
    print(f.mode) # 读取模式
    print(f.encoding) # 读取编码
    print(f.errors) # 编码错误时的处理方式，默认是‘strict’

</code></pre>
<h4 id="python3-中的newline"><a href="#python3-中的newline" class="headerlink" title="python3 中的newline"></a>python3 中的<code>newline</code></h4><p>默认情况下，Python会以统一模式处理换行符，识别所有的普通换行符并将其转换为单个 <code>\n</code> 字符。</p>
<p>如果你不想要这种默认的处理方式，可以给 <code>open()</code> 函数传入参数 <code>newline=&#39;&#39;</code>，<strong>注意，这不是清除换行符的作用</strong></p>
<pre><code class="python">&gt;&gt;&gt; # 启用 Newline 转换
&gt;&gt;&gt; f = open(&#39;hello.txt&#39;, &#39;rt&#39;)
&gt;&gt;&gt; f.read()
&#39;hello world!\n&#39;

&gt;&gt;&gt; # 禁用 Newline 转换 
&gt;&gt;&gt; g = open(&#39;hello.txt&#39;, &#39;rt&#39;, newline=&#39;&#39;)
&gt;&gt;&gt; g.read()
&#39;hello world!\r\n&#39;
</code></pre>
<h3 id="打印到文件中-参数file"><a href="#打印到文件中-参数file" class="headerlink" title="打印到文件中,参数file"></a>打印到文件中,参数<code>file</code></h3><p>在 <code>print()</code> 函数中指定 <code>file</code> 关键字参数，像下面这样，文件必须是<strong>以文本模式打开</strong>。 </p>
<pre><code class="python">with open(&#39;d:/work/test.txt&#39;, &#39;wt&#39;) as f:
    print(&#39;Hello World!&#39;, file=f)
</code></pre>
<h3 id="指定打印分隔符或行终止符"><a href="#指定打印分隔符或行终止符" class="headerlink" title="指定打印分隔符或行终止符"></a>指定打印分隔符或行终止符</h3><p>可以使用在 <code>print()</code> 函数中使用 <code>sep</code> 和 <code>end</code> 关键字参数，以你想要的方式输出。</p>
<pre><code class="python">&gt;&gt;&gt; print(&#39;ACME&#39;, 50, 91.5)
ACME 50 91.5
&gt;&gt;&gt; print(&#39;ACME&#39;, 50, 91.5, sep=&#39;,&#39;)
ACME,50,91.5
&gt;&gt;&gt; print(&#39;ACME&#39;, 50, 91.5, sep=&#39;,&#39;, end=&#39;!!\n&#39;)
ACME,50,91.5!!
</code></pre>
<p>有时候你会看到一些程序员会使用 <code>str.join()</code> 来完成同样的事情。比如：</p>
<pre><code class="python">&gt;&gt;&gt; print(&#39;,&#39;.join((&#39;ACME&#39;,&#39;50&#39;,&#39;91.5&#39;)))
ACME,50,91.5
</code></pre>
<p><code>str.join()</code> 的问题在于它仅仅适用于字符串，如果列表中有数值，就需要另外的转换。</p>
<p>你当然可以不用那么麻烦，只需要像下面这样写：</p>
<pre><code class="python">&gt;&gt;&gt; print(*row, sep=&#39;,&#39;)
ACME,50,91.5
</code></pre>
<h3 id="读写压缩文件"><a href="#读写压缩文件" class="headerlink" title="读写压缩文件"></a>读写压缩文件</h3><p>如下，所有的I/O操作都使用文本模式并执行Unicode的编码/解码。 类似的，如果你想操作二进制数据，使用 <code>rb</code> 或者 <code>wb</code> 文件模式即可。</p>
<pre><code class="python"># gzip compression
import gzip
with gzip.open(&#39;somefile.gz&#39;, &#39;rt&#39;) as f:
    text = f.read()

# bz2 compression
import bz2
with bz2.open(&#39;somefile.bz2&#39;, &#39;rt&#39;) as f:
    text = f.read()
</code></pre>
<blockquote>
<p>  如果你不指定模式，那么默认的就是二进制模式。</p>
</blockquote>
<p><strong>参数</strong></p>
<p><code>gzip.open()</code> 和 <code>bz2.open()</code> 接受跟内置的 <code>open()</code> 函数一样的参数， 包括 <code>encoding</code>，<code>errors</code>，<code>newline</code> 等等。</p>
<p>当写入压缩数据时，可以使用 <code>compresslevel</code> 这个可选的关键字参数来指定一个压缩级别。比如：</p>
<pre><code class="python">with gzip.open(&#39;somefile.gz&#39;, &#39;wt&#39;, compresslevel=5) as f:
    f.write(text)
</code></pre>
<p>默认的等级是9，也是最高的压缩等级。等级越低性能越好，但是数据压缩程度也越低。</p>
<p><strong>特性</strong></p>
<p>最后一点，  它们可以作用在一个已存在并以二进制模式打开的文件上。比如，下面代码是可行的：</p>
<pre><code class="python">import gzip
f = open(&#39;somefile.gz&#39;, &#39;rb&#39;)
with gzip.open(f, &#39;rt&#39;) as g:
    text = g.read()
</code></pre>
<p>这样就允许 <code>gzip</code> 和 <code>bz2</code> 模块可以工作在许多类文件对象上，比如套接字，管道和内存中文件等。</p>
<h3 id="文件、路径操作"><a href="#文件、路径操作" class="headerlink" title="文件、路径操作"></a>文件、路径操作</h3><h4 id="路径名操作"><a href="#路径名操作" class="headerlink" title="路径名操作"></a>路径名操作</h4><p>请看 <a href="http://localhost:4000/2019/08/06/python小模块/#os-path" target="_blank" rel="noopener">Python 小模块的 os.path</a></p>
<h4 id="测试文件"><a href="#测试文件" class="headerlink" title="测试文件"></a>测试文件</h4><p>请看 <a href="http://localhost:4000/2019/08/06/python小模块/#os-path" target="_blank" rel="noopener">Python 小模块的 os.path</a></p>
<h4 id="文件列表"><a href="#文件列表" class="headerlink" title="文件列表"></a>文件列表</h4><p>列出指定目录下的全部文件和目录，非递归获取。</p>
<blockquote>
<p>  函数 <code>os.listdir()</code> 返回的实体列表会根据系统默认的文件名编码来解码。 但是有时候也会碰到一些不能正常解码的文件名，请参考下一节</p>
</blockquote>
<pre><code class="python">import os.path

names = os.listdir(&#39;somedir&#39;)

# 获取文件
filenames = [name for name in names
        if os.path.isfile(os.path.join(&#39;somedir&#39;, name))]

# 获取目录
dirnames = [name for name in names
        if os.path.isdir(os.path.join(&#39;somedir&#39;, name))]  
</code></pre>
<p>获取某类文件</p>
<pre><code class="python"># 方法 1：字符串简单匹配
import os
names = os.listdir(&#39;somedir&#39;)
pyfiles = [name for name in os.listdir(&#39;somedir&#39;)
            if name.endswith(&#39;.py&#39;)]

# 方法 2：fnmatch 模块
from fnmatch import fnmatch
pyfiles = [name for name in os.listdir(&#39;somedir&#39;)
            if fnmatch(name, &#39;*.py&#39;)]

# 方法 3：glob 模块 推荐
import glob
pyfiles = glob.glob(&#39;somedir/*.py&#39;)
</code></pre>
<h3 id="文件名编码"><a href="#文件名编码" class="headerlink" title="文件名编码"></a>文件名编码</h3><p>通常来讲，你不需要担心文件名的编码和解码，普通的文件名操作应该就没问题了。</p>
<p><strong>字符串表示文件名（默认情况）</strong></p>
<p>默认情况下，所有的文件名都会根据 <code>sys.getfilesystemencoding()</code> 返回的文本编码来编码或解码</p>
<p><strong>原始字节字符串表示文件名</strong></p>
<p>如果因为某种原因你想忽略这种编码，可以使用一个<strong>原始字节字符串来指定一个文件名</strong>即可。</p>
<pre><code class="python">&gt;&gt;&gt; # 创建一个unicode编码的文件
&gt;&gt;&gt; with open(&#39;jalape\xf1o.txt&#39;, &#39;w&#39;) as f:
...     f.write(&#39;Spicy!&#39;)
...
6
&gt;&gt;&gt; # 打印目录 (默认进行解码ecoded)
&gt;&gt;&gt; import os
&gt;&gt;&gt; os.listdir(&#39;.&#39;)
[&#39;jalapeño.txt&#39;]

&gt;&gt;&gt; # 打印目录 (使用原始字节字符串)
&gt;&gt;&gt; os.listdir(b&#39;.&#39;)     # 通过传递 字节字符串 来提示 Python 不要解码
[b&#39;jalapen\xcc\x83o.txt&#39;]

&gt;&gt;&gt; # Open file with raw filename
&gt;&gt;&gt; with open(b&#39;jalapen\xcc\x83o.txt&#39;) as f:
...     print(f.read())
...
Spicy!
</code></pre>
<h4 id="打印不合法的文件名"><a href="#打印不合法的文件名" class="headerlink" title="打印不合法的文件名"></a>打印不合法的文件名</h4><p>默认情况下，Python假定所有文件名都已经根据 <code>sys.getfilesystemencoding()</code> 的值编码过了。 但是，有一些文件系统并没有强制要求这样做，因此允许创建文件名没有正确编码的文件。 </p>
<p>操作不合法的文件名或者将文件名传递给 <code>open()</code> 这样的函数时，一切都能正常工作。 <strong>只有当你想要输出文件名时才会碰到些麻烦</strong>(比如打印输出到屏幕或日志文件等)。 </p>
<pre><code class="python">&gt;&gt;&gt; import os
&gt;&gt;&gt; files = os.listdir(&#39;.&#39;)
&gt;&gt;&gt; files
[&#39;spam.py&#39;, &#39;b\udce4d.txt&#39;, &#39;foo.txt&#39;]
&gt;&gt;&gt; for name in files:
...     print(name)
...
spam.py
Traceback (most recent call last):
    File &quot;&lt;stdin&gt;&quot;, line 2, in &lt;module&gt;
UnicodeEncodeError: &#39;utf-8&#39; codec can&#39;t encode character &#39;\udce4&#39; in
position 1: surrogates not allowed
&gt;&gt;&gt;
</code></pre>
<p><strong>解决方法</strong></p>
<pre><code class="python"># 方法 1，简单处理
def bad_filename(filename):
    return repr(filename)[1:-1]
# 方法 2，以正确的编码进行解码
def bad_filename(filename):
    # filename 是 unicode 码，因此先进行编码，最后再解码
    temp = filename.encode(sys.getfilesystemencoding(), errors=&#39;surrogateescape&#39;)
    return temp.decode(&#39;latin-1&#39;)

for name in files:
     try:
         print(name)
     except UnicodeEncodeError:
         print(bad_filename(name))

spam.py
bäd.txt
foo.txt
</code></pre>
<blockquote>
<p>  <code>surrogateescape</code>:<br>  这种是Python在绝大部分面向OS的API中所使用的错误处理器，<br>  它能以一种优雅的方式处理由操作系统提供的数据的编码问题。<br>  在解码出错时会将出错字节存储到一个很少被使用到的Unicode编码范围内。<br>  在编码时将那些隐藏值又还原回原先解码失败的字节序列。<br>  它不仅对于OS API非常有用，也能很容易的处理其他情况下的编码错误。</p>
</blockquote>
<h3 id="文件对象的层次结构"><a href="#文件对象的层次结构" class="headerlink" title="文件对象的层次结构"></a>文件对象的层次结构</h3><p>I/O系统由一系列的层次构建而成。你可以试着运行下面这个操作一个文本文件的例子来查看这种层次：</p>
<pre><code class="python">&gt;&gt;&gt; f = open(&#39;sample.txt&#39;,&#39;w&#39;)
&gt;&gt;&gt; f
&lt;_io.TextIOWrapper name=&#39;sample.txt&#39; mode=&#39;w&#39; encoding=&#39;UTF-8&#39;&gt;
&gt;&gt;&gt; f.buffer
&lt;_io.BufferedWriter name=&#39;sample.txt&#39;&gt;
&gt;&gt;&gt; f.buffer.raw
&lt;_io.FileIO name=&#39;sample.txt&#39; mode=&#39;wb&#39;&gt;
</code></pre>
<ol>
<li><p><code>io.TextIOWrapper</code> 是一个编码和解码Unicode的文本处理层，增加或改变文本编码会涉及这一层。</p>
</li>
<li><p><code>io.BufferedWriter</code> 是一个处理二进制数据的带缓冲的I/O层。</p>
</li>
<li><code>io.FileIO</code> 是一个表示操作系统底层文件描述符的原始文件。</li>
</ol>
<p>如果你想<strong>修改一个已经打开的文本模式的文件的编码方式</strong>(暂时不知道有什么用途)，可以先使用 <code>detach()</code> 方法移除掉已存在的文本编码层， 并使用新的编码方式代替。<code>detach()</code> 方法会断开文件的最顶层并返回第二层，之后最顶层就没什么用了。</p>
<pre><code class="python">f = open(&#39;sample.txt&#39;, &#39;w&#39;)
# &lt;_io.TextIOWrapper name=&#39;sample.txt&#39; mode=&#39;w&#39; encoding=&#39;UTF-8&#39;&gt;
b = f.detach() # 返回的第2层
# &lt;_io.BufferedWriter name=&#39;sample.txt&#39;&gt;
f.write(&#39;hello&#39;)
# Traceback (most recent call last):
#    File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
# ValueError: underlying buffer has been detached

f = io.TextIOWrapper(b, encoding=&#39;latin-1&#39;)
# &lt;_io.TextIOWrapper name=&#39;sample.txt&#39; encoding=&#39;latin-1&#39;&gt;
</code></pre>
<h4 id="将字节写入文本文件"><a href="#将字节写入文本文件" class="headerlink" title="将字节写入文本文件"></a>将字节写入文本文件</h4><p>如果你想在文本模式打开的文件中写入原始的字节数据，可以将字节数据直接写入文件的缓冲区即可，例如：</p>
<pre><code class="python">&gt;&gt;&gt; import sys
&gt;&gt;&gt; sys.stdout.write(b&#39;Hello\n&#39;)
Traceback (most recent call last):
    File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
TypeError: must be str, not bytes
&gt;&gt;&gt; sys.stdout.buffer.write(b&#39;Hello\n&#39;)
Hello
5
</code></pre>
<p>类似的，能够通过读取文本文件的 <code>buffer</code> 属性来读取二进制数据。</p>
<p>原理：I/O系统以<strong>层级结构的形式</strong>构建而成。 文本文件是通过在一个拥有缓冲的二进制模式文件上增加一个Unicode编码/解码层来创建。 <code>buffer</code> 属性指向对应的底层文件。如果你<strong>直接访问它的话就会绕过文本编码/解码层</strong>。</p>
<h3 id="创建临时文件和文件夹"><a href="#创建临时文件和文件夹" class="headerlink" title="创建临时文件和文件夹"></a>创建临时文件和文件夹</h3><p><code>tempfile</code> 模块中有很多的函数可以完成这任务。</p>
<p><strong>临时文件</strong>：<code>tempfile.TemporaryFile</code></p>
<pre><code class="python">with TemporaryFile(&#39;w+t&#39;，encoding=&#39;utf-8&#39;, errors=&#39;ignore&#39;) as f:
    # Read/write to the file
    f.write(&#39;Hello World\n&#39;)
    f.write(&#39;Testing\n&#39;)

    # Seek back to beginning and read the data
    f.seek(0)
    data = f.read()

# Temporary file is destroyed
</code></pre>
<ul>
<li>通常来讲文本模式使用 <code>w+t</code> ，二进制模式使用 <code>w+b</code> 。 这个模式同时支持读和写操作，在这里是很有用的</li>
<li>结果文件关闭时会被自动删除掉。 如果你不想这么做，传递关键字参数 <code>delete=False</code> </li>
<li>所有和临时文件相关的函数都允许通过使用关键字参数 <code>prefix</code> 、<code>suffix</code> 和 <code>dir</code> 来自定义目录以及命名规则</li>
</ul>
<p><strong>带名字的临时文件</strong>：<code>tempfile.NamedTemporaryFile</code></p>
<pre><code class="python">with NamedTemporaryFile(&#39;w+t&#39;, delete=False, prefix=&#39;mytemp&#39;, suffix=&#39;.txt&#39;, dir=&#39;/tmp&#39;) as f:
    print(&#39;filename is:&#39;, f.name)
# &#39;/tmp/mytemp8ee899.txt&#39;
</code></pre>
<p><strong>临时目录</strong>： <code>tempfile.TemporaryDirectory()</code> </p>
<pre><code class="python">from tempfile import TemporaryDirectory

with TemporaryDirectory() as dirname:
    print(&#39;dirname is:&#39;, dirname)
    # Use the directory
    ...
# Directory and all contents destroyed
</code></pre>
<h2 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h2><p>12.10~12.14 TODO</p>
</the></excerpt>
  
  
    
    <div class='footer'>
      
      
      
        <div class='copyright'>
          <blockquote>
            
              
                <p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p>

              
            
              
                <p>本文永久链接是：<a href=https://jizx.vip/2019/12/01/python-cookbook/>https://jizx.vip/2019/12/01/python-cookbook/</a></p>
              
            
          </blockquote>
        </div>
      
      
    </div>
  
  
    


  <div class='article-meta' id="bottom">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2019-12-08T22:53:00+08:00">
  <a class='notlink'>
    <i class="fas fa-edit fa-fw" aria-hidden="true"></i>
    <p>更新于：Dec 8, 2019</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/python/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>python</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/ing/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>ing</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/time/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>time</p></a></div>


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="" rel="external nofollow noopener noreferrer"
          
          href="http://connect.qq.com/widget/shareqq/index.html?url=https://jizx.vip/2019/12/01/python-cookbook/&title=python cookbook - 玖玖的博客&summary= 

python cookbook的阅读笔记，对内容进行了简练。将常用的知识点记录下来。"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qq.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qq.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="" rel="external nofollow noopener noreferrer"
          
          href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://jizx.vip/2019/12/01/python-cookbook/&title=python cookbook - 玖玖的博客&summary= 

python cookbook的阅读笔记，对内容进行了简练。将常用的知识点记录下来。"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qzone.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qzone.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="" rel="external nofollow noopener noreferrer"
          
          href="http://service.weibo.com/share/share.php?url=https://jizx.vip/2019/12/01/python-cookbook/&title=python cookbook - 玖玖的博客&summary= 

python cookbook的阅读笔记，对内容进行了简练。将常用的知识点记录下来。"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/weibo.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/weibo.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=">
          
        </a>
      
    
      
    
      
    
  </div>
</div>



        
      
    </div>
  </div>


  
  

  
    <div class="prev-next">
      
        <a class='prev' href='/2019/12/07/python-多线程/'>
          <p class='title'><i class="fas fa-chevron-left" aria-hidden="true"></i>python 多线程与多进程</p>
          <p class='content'> 






概述与线程相关的标准库模块

线程实现方式一，定义线程函数，实例化Thread类（简单）
# Code to execute in an independent thread
i...</p>
        </a>
      
      
        <a class='next' href='/2019/10/28/推荐网站/'>
          <p class='title'>推荐网站<i class="fas fa-chevron-right" aria-hidden="true"></i></p>
          <p class='content'> 

推荐一些发现的高质量学习网站



python
python 3.6 入门指南

python cookbook 非常多的实践经验

Python 3 标准库实例教程

pandas 1...</p>
        </a>
      
    </div>
  
</article>


  

  <article class="post white-box reveal shadow" id="comments">
    <p ct><i class='fas fa-comments'></i> 评论</p>
    
    <div id="valine_container" class="valine_thread">
  <i class="fas fa-cog fa-spin fa-fw fa-2x"></i>
</div>

  </article>






</div>
<aside class='l_side'>
  
  
    
    



  <section class="widget toc-wrapper shadow desktop mobile" id="toc-div" >
    
  <header>
    
      <i class="fas fa-list fa-fw" aria-hidden="true"></i><span class='name'>本文目录</span>
    
  </header>


    <div class='content'>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#数据结构"><span class="toc-text">数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#字典"><span class="toc-text">字典</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#字典的构造方式"><span class="toc-text">字典的构造方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#字典键值的获取"><span class="toc-text">字典键值的获取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#字典键值的添加"><span class="toc-text">字典键值的添加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#设置默认值"><span class="toc-text">设置默认值</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#队列与堆"><span class="toc-text">队列与堆</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#deque队列"><span class="toc-text">deque队列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#heapq堆-TODO"><span class="toc-text">heapq堆(TODO )</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解压赋值、星号表达式"><span class="toc-text">解压赋值、星号表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#解压赋值给多个变量"><span class="toc-text">解压赋值给多个变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#变量与星号"><span class="toc-text">变量与星号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#函数与星号"><span class="toc-text">函数与星号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#zip与星号"><span class="toc-text">zip与星号(*)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#字符串处理"><span class="toc-text">字符串处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#用Shell通配符匹配字符串"><span class="toc-text">用Shell通配符匹配字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#正则表达式匹配字符串"><span class="toc-text">正则表达式匹配字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字符串搜索和替换"><span class="toc-text">字符串搜索和替换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多行匹配模式"><span class="toc-text">多行匹配模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#将Unicode文本标准化-统一unicode文本"><span class="toc-text">将Unicode文本标准化(统一unicode文本)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#标准化的标准"><span class="toc-text">标准化的标准</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#处理和音字符（TODO-2-12还没看）"><span class="toc-text">处理和音字符（TODO 2.12还没看）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#正则中匹配unicode字符"><span class="toc-text">正则中匹配unicode字符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#注意大小写转换问题"><span class="toc-text">注意大小写转换问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删除字符串中空白字符（不需要的字符）"><span class="toc-text">删除字符串中空白字符（不需要的字符）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#开始、结束的字符"><span class="toc-text">开始、结束的字符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#中间的字符"><span class="toc-text">中间的字符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#strip与生成器"><span class="toc-text">strip与生成器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字符串对齐"><span class="toc-text">字符串对齐</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#合并拼接字符串"><span class="toc-text">合并拼接字符串</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#推荐使用-join"><span class="toc-text">推荐使用 join</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#避免不必要的拼接"><span class="toc-text">避免不必要的拼接</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#以指定列宽-格式化字符串"><span class="toc-text">以指定列宽 格式化字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在字符串中处理html和xml-TODO-未看"><span class="toc-text">在字符串中处理html和xml(TODO 未看)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字符串令牌解析-TODO-未看"><span class="toc-text">字符串令牌解析(TODO 未看)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数字日期和时间"><span class="toc-text">数字日期和时间</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#数字的四舍五入"><span class="toc-text">数字的四舍五入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#简单的四舍五入"><span class="toc-text">简单的四舍五入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数值格式化指令"><span class="toc-text">数值格式化指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#进制"><span class="toc-text">进制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-进制—-gt-其他"><span class="toc-text">10 进制—&gt;其他</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#其他—-gt-10-进制"><span class="toc-text">其他—&gt;10 进制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#无穷大与-NaN"><span class="toc-text">无穷大与 NaN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分数运算"><span class="toc-text">分数运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#随机"><span class="toc-text">随机</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#随机小数"><span class="toc-text">随机小数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#随机整数"><span class="toc-text">随机整数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#随机选择数组中的1个"><span class="toc-text">随机选择数组中的1个</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#随机选择数组中的-N个"><span class="toc-text">随机选择数组中的 N个</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#时间处理"><span class="toc-text">时间处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#datetime-模块"><span class="toc-text">datetime 模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#循环时间"><span class="toc-text">循环时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#字符串与时间对象"><span class="toc-text">字符串与时间对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#时区"><span class="toc-text">时区</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#迭代器与生成器"><span class="toc-text">迭代器与生成器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#next函数"><span class="toc-text">next函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文件与-IO"><span class="toc-text">文件与 IO</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TODO-5-4，5-6，-5-8，5-9，5-10，5-18-5-20-略"><span class="toc-text">TODO 5.4，5.6， 5.8，5.9，5.10，5.18, 5.20(略)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#读写文本文件"><span class="toc-text">读写文本文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rt-wt-at模式"><span class="toc-text">rt,wt,at模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#x模式，文件不存在才能写入"><span class="toc-text">x模式，文件不存在才能写入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#文件对象的属性"><span class="toc-text">文件对象的属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#python3-中的newline"><span class="toc-text">python3 中的newline</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#打印到文件中-参数file"><span class="toc-text">打印到文件中,参数file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#指定打印分隔符或行终止符"><span class="toc-text">指定打印分隔符或行终止符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#读写压缩文件"><span class="toc-text">读写压缩文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件、路径操作"><span class="toc-text">文件、路径操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#路径名操作"><span class="toc-text">路径名操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#测试文件"><span class="toc-text">测试文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#文件列表"><span class="toc-text">文件列表</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件名编码"><span class="toc-text">文件名编码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#打印不合法的文件名"><span class="toc-text">打印不合法的文件名</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件对象的层次结构"><span class="toc-text">文件对象的层次结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#将字节写入文本文件"><span class="toc-text">将字节写入文本文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建临时文件和文件夹"><span class="toc-text">创建临时文件和文件夹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#多线程"><span class="toc-text">多线程</span></a></li></ol>
    </div>
  </section>


  


</aside>



      </div>
      
  
  <footer class="footer clearfix">
    <br><br>
    
      
        <div class="aplayer-container">
          


        </div>
      
    
      
        <br>
        <div class="social-wrapper">
          
            
          
            
          
            
          
        </div>
      
    
      
        <div><p>Blog content follows the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0) License</a></p>
</div>
      
    
      
        
          <div><p><span id="lc-sv">本站总访问量为 <span id='number'><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span> 次</span> <span id="lc-uv">访客数为 <span id='number'><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span> 人</span></p>
</div>
        
      
    
      
        Use
        <a href="https://github.com/volantis-x/hexo-theme-volantis/tree/4.0.0-rc.4" target="_blank" class="codename">Volantis</a>
        as theme
      
    
      
        <div class='copyright'>
        <p><a href="/">Copyright © 2017-2020 </a></p>

        </div>
      
    
  </footer>


      <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
    </div>
  </div>
  <div>
    <!-- required -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5/dist/jquery.min.js"></script>
<script>
  function pjax_fancybox() {
    $(".md .gallery").find("img").each(function () { //渲染 fancybox
      var element = document.createElement("a"); // a 标签
      $(element).attr("class", "fancybox");
      $(element).attr("pjax-fancybox", "");  // 过滤 pjax
      $(element).attr("href", $(this).attr("src"));
      if ($(this).attr("data-original")) {
        $(element).attr("href", $(this).attr("data-original"));
      }
      $(element).attr("data-fancybox", "images");
      var caption = "";   // 描述信息
      if ($(this).attr('alt')) {  // 判断当前页面是否存在描述信息
        $(element).attr('data-caption', $(this).attr('alt'));
        caption = $(this).attr('alt');
      }
      var div = document.createElement("div");
      $(div).addClass("fancybox");
      $(this).wrap(div); // 最外层套 div ，其实主要作用还是 class 样式
      var span = document.createElement("span");
      $(span).addClass("image-caption");
      $(span).text(caption); // 加描述
      $(this).after(span);  // 再套一层描述
      $(this).wrap(element);  // 最后套 a 标签
    })
    $(".md .gallery").find("img").fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
      closeClick: true,
      helpers: {
        overlay: {closeClick: true}
      },
      buttons: [
        "zoom",
        "close"
      ]
    });
  };
  function SCload_fancybox() {
    if ($(".md .gallery").find("img").length == 0) return;
    loadCSS("https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css", document.getElementById("loadcss"));
    setTimeout(function() {
      loadScript('https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js', pjax_fancybox)
    }, 1);
  };
  $(function () {
    SCload_fancybox();
  });
</script>


<!-- internal -->

  
  
  
    <script src="https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js"></script>
    <script type="text/javascript">
      $(function(){
        var imgs=["https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/001.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/002.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/003.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/004.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/005.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/006.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/012.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/016.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/019.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/033.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/034.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/035.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/038.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/039.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/042.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/044.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/046.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/051.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/052.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/056.jpg"];
        if ('true' == 'true') {
          function shuffle(arr){
            /*From countercurrent-time*/
            var n = arr.length;
            while(n--) {
              var index = Math.floor(Math.random() * n);
              var temp = arr[index];
              arr[index] = arr[n];
              arr[n] = temp;
            }
          }
          shuffle(imgs);
        }
        if ('') {
          $('').backstretch(
            imgs,
          {
            duration: "100000",
            fade: "1500"
          });
        } else {
          $.backstretch(
            imgs,
          {
            duration: "100000",
            fade: "1500"
          });
        }
      });
    </script>
  







  <script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>




  
  
    <script>
      window.FPConfig = {
        delay: 0,
        ignoreKeywords: [],
        maxRPS: 5,
        hoverDelay: 25
      };
    </script>
    <script defer src="https://cdn.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"></script>
  




  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
    var clipboard = new ClipboardJS('.btn-copy', {
        target: function (trigger) {
            return trigger.nextElementSibling
        }
    });
    function wait(callback, seconds) {
        var timelag = null;
        timelag = window.setTimeout(callback, seconds)
    }
    function pjax_initCopyCode() {
		if($(".highlight .code pre").length+$(".article pre code").length==0)return;
        var copyHtml = '';
        copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
        copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
        copyHtml += '</button>';
        $(".highlight .code pre").before(copyHtml);
        $(".article pre code").before(copyHtml);
        clipboard.off('success').on('success', function (e) {
            let $btn = $(e.trigger);
            $btn.addClass('copied');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-check-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPIED';
            wait(function () {
                $icon.removeClass('fa-check-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        });
        clipboard.off('error').on('error', function (e) {
            e.clearSelection();
            let $btn = $(e.trigger);
            $btn.addClass('copy-failed');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-times-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPY FAILED';
            wait(function () {
                $icon.removeClass('fa-times-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        })
    }
    $(function () {
        pjax_initCopyCode()
    });
</script>








  
  <script src="/js/valine.js"></script>

<script>
  var GUEST_INFO = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link'.split(',').filter(function (item) {
    return GUEST_INFO.indexOf(item) > -1
  });
  var REQUIRED_FIELDS = ['nick', 'mail', 'link'];
  var requiredFields = 'nick,mail'.split(',').filter(function (item) {
    return REQUIRED_FIELDS.indexOf(item) > -1
  });

  function emoji(path, idx, ext) {
    return path + "/" + path + "-" + idx + "." + ext;
  }

  var emojiMaps = {};
  for (var i = 1; i <= 54; i++) {
    emojiMaps['tieba-' + i] = emoji('tieba', i, 'png');
  }
  for (var i = 1; i <= 101; i++) {
    emojiMaps['qq-' + i] = emoji('qq', i, 'gif');
  }
  for (var i = 1; i <= 116; i++) {
    emojiMaps['aru-' + i] = emoji('aru', i, 'gif');
  }
  for (var i = 1; i <= 125; i++) {
    emojiMaps['twemoji-' + i] = emoji('twemoji', i, 'png');
  }
  for (var i = 1; i <= 4; i++) {
    emojiMaps['weibo-' + i] = emoji('weibo', i, 'png');
  }

  function pjax_valine() {
    if(!document.querySelectorAll("#valine_container")[0])return;

    let pagePlaceholder = $.trim($('#pjax-comment-placeholder').text()) || "快来评论吧~";

    let path = $.trim($('#pjax-comment-path').text());
    if (path.length == 0) {
      let defaultPath = '';
      path = defaultPath || decodeURI(window.location.pathname);
    }

    var valine = new Valine();
    valine.init({
      el: '#valine_container',
      meta: meta,
      placeholder: pagePlaceholder,
      path: path,
      appId: "",
      appKey: "",
      pageSize: '10',
      avatar: 'robohash',
      lang: 'zh-cn',
      visitor: 'true',
      highlight: 'true',
      mathJax: 'false',
      enableQQ: 'true',
      requiredFields: requiredFields,
      emojiCDN: 'https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/valine/',
      emojiMaps: emojiMaps
    })
  }

  $(function () {
    pjax_valine();
  });
</script>







  <script src="/js/app.js"></script>



  
    <script src="/js/search.js"></script>
  


<!-- optional -->

  <script>
const SearchServiceimagePath="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@master/img/";
const ROOT =  ("/" || "/").endsWith('/') ? ("/" || "/") : ("//" || "/" );
(function ($) {
  
    customSearch = new HexoSearch({
      imagePath: SearchServiceimagePath
    });
  
})(jQuery);

</script>









  
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  



  <script defer>

  const LCCounter = {
    app_id: 'u9j57bwJod4EDmXWdxrwuqQT-MdYXbMMI',
    app_key: 'jfHtEKVE24j0IVCGHbvuFClp',
    custom_api_server: '',

    // 查询存储的记录
    getRecord(Counter, url, title) {
      return new Promise(function (resolve, reject) {
        Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({url})))
          .then(resp => resp.json())
          .then(({results, code, error}) => {
            if (code === 401) {
              throw error;
            }
            if (results && results.length > 0) {
              var record = results[0];
              resolve(record);
            } else {
              Counter('post', '/classes/Counter', {url, title: title, times: 0})
                .then(resp => resp.json())
                .then((record, error) => {
                  if (error) {
                    throw error;
                  }
                  resolve(record);
                }).catch(error => {
                console.error('Failed to create', error);
                reject(error);
              });
            }
          }).catch((error) => {
          console.error('LeanCloud Counter Error:', error);
          reject(error);
        });
      })
    },

    // 发起自增请求
    increment(Counter, incrArr) {
      return new Promise(function (resolve, reject) {
        Counter('post', '/batch', {
          "requests": incrArr
        }).then((res) => {
          res = res.json();
          if (res.error) {
            throw res.error;
          }
          resolve(res);
        }).catch((error) => {
          console.error('Failed to save visitor count', error);
          reject(error);
        });
      });
    },

    // 构建自增请求体
    buildIncrement(objectId) {
      return {
        "method": "PUT",
        "path": `/1.1/classes/Counter/${ objectId }`,
        "body": {
          "times": {
            '__op': 'Increment',
            'amount': 1
          }
        }
      }
    },

    // 校验是否为有效的 UV
    validUV() {
      var key = 'LeanCloudUVTimestamp';
      var flag = localStorage.getItem(key);
      if (flag) {
        // 距离标记小于 24 小时则不计为 UV
        if (new Date().getTime() - parseInt(flag) <= 86400000) {
          return false;
        }
      }
      localStorage.setItem(key, new Date().getTime().toString());
      return true;
    },

    addCount(Counter) {
      var enableIncr = '' === 'true' && window.location.hostname !== 'localhost';
      enableIncr = true;
      var getterArr = [];
      var incrArr = [];
      // 请求 PV 并自增
      var pvCtn = document.querySelector('#lc-sv');
      if (pvCtn || enableIncr) {
        var pvGetter = this.getRecord(Counter, 'https://jizx.vip' + '/#lc-sv', 'Visits').then((record) => {
          incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-sv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + 1;
              if (pvCtn) {
                pvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(pvGetter);
      }

      // 请求 UV 并自增
      var uvCtn = document.querySelector('#lc-uv');
      if (uvCtn || enableIncr) {
        var uvGetter = this.getRecord(Counter, 'https://jizx.vip' + '/#lc-uv', 'Visitors').then((record) => {
          var vuv = this.validUV();
          vuv && incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-uv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + (vuv ? 1 : 0);
              if (uvCtn) {
                uvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(uvGetter);
      }

      // 请求文章的浏览数，如果是当前页面就自增
      var allPV = document.querySelectorAll('#lc-pv');
      if (allPV.length > 0 || enableIncr) {
        for (i = 0; i < allPV.length; i++) {
          let pv = allPV[i];
          let title = pv.getAttribute('data-title');
          var url = 'https://jizx.vip' + pv.getAttribute('data-path');
          if (url) {
            var viewGetter = this.getRecord(Counter, url, title).then((record) => {
              // 是当前页面就自增
              let curPath = window.location.pathname;
              if (curPath.includes('index.html')) {
                curPath = curPath.substring(0, curPath.lastIndexOf('index.html'));
              }
              if (pv.getAttribute('data-path') == curPath) {
                incrArr.push(this.buildIncrement(record.objectId));
              }
              if (pv) {
                var ele = pv.querySelector('#lc-pv #number');
                if (ele) {
                  if (pv.getAttribute('data-path') == curPath) {
                    ele.innerText = (record.times || 0) + 1;
                  } else {
                    ele.innerText = record.times || 0;
                  }
                  pv.style.display = 'inline';
                }
              }
            });
            getterArr.push(viewGetter);
          }
        }
      }

      // 如果启动计数自增，批量发起自增请求
      if (enableIncr) {
        Promise.all(getterArr).then(() => {
          incrArr.length > 0 && this.increment(Counter, incrArr);
        })
      }

    },


    fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${ api_server }/1.1${ url }`, {
          method,
          headers: {
            'X-LC-Id': this.app_id,
            'X-LC-Key': this.app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      this.addCount(Counter);
    },

    refreshCounter() {
      var api_server = this.app_id.slice(-9) !== '-MdYXbMMI' ? this.custom_api_server : `https://${ this.app_id.slice(0, 8).toLowerCase() }.api.lncldglobal.com`;
      if (api_server) {
        this.fetchData(api_server);
      } else {
        fetch('https://app-router.leancloud.cn/2/route?appId=' + this.app_id)
          .then(resp => resp.json())
          .then(({api_server}) => {
            this.fetchData('https://' + api_server);
          });
      }
    }

  };

  LCCounter.refreshCounter();

  document.addEventListener('pjax:complete', function () {
    LCCounter.refreshCounter();
  });
</script>



<!-- more -->


    
      

<script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script>
<!-- 样式位于：source/css/_third-party/pjaxanimate.styl -->

<div class="pjax-animate">
  
    <script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>
    <div id="loading-bar-wrapper"><script>NProgress.configure({parent:"#loading-bar-wrapper",trickleSpeed: 100})</script></div>
    <script>
      window.ShowLoading = function() {
        NProgress.start();
      };
      window.HideLoading = function() {
        NProgress.done();
      }
    </script>
  
</div>

<script>
    var pjax;
    document.addEventListener('DOMContentLoaded', function () {
      pjax = new Pjax({
        elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox])',
        selectors: [
          "title",
          "#pjax-container",
          "#pjax-header-nav-list"
        ],
        cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
        timeout: 5000
      });
    });

    document.addEventListener('pjax:send', function (e) {
      window.stop(); // 相当于点击了浏览器的停止按钮

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      window.subData = null; // 移除标题（用于一二级导航栏切换处）
      if (typeof $.fancybox != "undefined") {
        $.fancybox.close();    // 关闭弹窗
      }
      $('.l_header .switcher .s-search').removeClass('active'); // 关闭移动端激活的搜索框
      $('.l_header').removeClass('z_search-open'); // 关闭移动端激活的搜索框
      $('.wrapper').removeClass('sub'); // 跳转页面时关闭二级导航

      // 解绑事件 避免重复监听
      $('.s-top').unbind('click');
      $('.menu a').unbind('click');
      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');
      window.ShowLoading();
    });

    document.addEventListener('pjax:complete', function () {
      // 关于百度统计对 SPA 页面的处理：
      // 方案一：百度统计>管理>单页应用设置中，打开开启按钮即可对SPA进行统计。 https://tongji.baidu.com/web/help/article?id=324
      // 方案二：取消注释下列代码。 https://tongji.baidu.com/web/help/article?id=235
      // 

      // 关于谷歌统计对 SPA 页面的处理：
      // 当应用以动态方式加载内容并更新地址栏中的网址时，也应该更新通过 gtag.js 存储的网页网址。
      // https://developers.google.cn/analytics/devguides/collection/gtagjs/single-page-applications?hl=zh-cn
      

      $('.nav-main').find('.list-v').not('.menu-phone').removeAttr("style",""); // 移除小尾巴的移除
      $('.menu-phone.list-v').removeAttr("style",""); // 移除小尾巴的移除
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
      try{
          if (typeof $.fancybox == "undefined") {
            SCload_fancybox();
          } else {
            pjax_fancybox();
          }
        
          
          if ('') {
            $('').backstretch("resize");
            if($('.cover-wrapper').is(':hidden')){
              $('.cover-backstretch').backstretch("pause");
            }else{
              $('.cover-backstretch').backstretch("next");
            }
          } else {
            $.backstretch("resize");
            if($('.cover-wrapper').is(':hidden')){
              $.backstretch("pause");
            }else{
              $.backstretch("next");
            }
          }
        
        
        document.querySelectorAll('pre code').forEach((block) => {
          hljs.highlightBlock(block);
        });
        
        
        
        
          pjax_initCopyCode();
        
        
          pjax_valine();
        
        
        
        
        
      } catch (e) {
        console.log(e);
      }
      window.HideLoading();
    });

    document.addEventListener('pjax:error', function (e) {
      window.HideLoading();
      window.location.href = e.triggerElement.href;
    });
</script>

    
  </div>
</body>
</html>
